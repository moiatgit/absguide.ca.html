

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>XXX 36.7. Assorted Tips &mdash; Guia Avançada de Programació Bash 10 març de 2014 documentació</title>
  

  
  

  

  
  
    

  

  
  
    <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  

  

  
        <link rel="copyright" title="Copyright" href="copyright.html"/>
    <link rel="top" title="Guia Avançada de Programació Bash 10 març de 2014 documentació" href="index.html"/> 

  
  <script src="_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-nav-search">
        

        
          <a href="index.html" class="icon icon-home"> Guia Avançada de Programació Bash
        

        
        </a>

        
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Cercar..." />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

        
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
        
          
          
              <ul>
<li class="toctree-l1"><a class="reference internal" href="part1.html">Part 1. Introducció</a></li>
<li class="toctree-l1"><a class="reference internal" href="part2.html">Part 2. Conceptes bàsics</a></li>
<li class="toctree-l1"><a class="reference internal" href="part3.html">XXX Part 3. Beyond the Basics</a></li>
<li class="toctree-l1"><a class="reference internal" href="part4.html">XXX Part 4. Commands</a></li>
<li class="toctree-l1"><a class="reference internal" href="part5.html">XXX Part 5. Advanced Topics</a></li>
<li class="toctree-l1"><a class="reference internal" href="endnotes.html">Notes finals</a></li>
<li class="toctree-l1"><a class="reference internal" href="biblio.html">XXX  Bibliografia</a></li>
</ul>

          
        
      </div>
      &nbsp;
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="index.html">Guia Avançada de Programació Bash</a>
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="index.html">Inici</a> &raquo;</li>
      
    <li>XXX  36.7. Assorted Tips</li>
      <li class="wy-breadcrumbs-aside">
        
          
        
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document">
            
  <div class="section" id="xxx-36-7-assorted-tips">
<h1>XXX  36.7. Assorted Tips<a class="headerlink" href="#xxx-36-7-assorted-tips" title="Link permanent a aquest títol">¶</a></h1>
<blockquote>
<div>36.7.1. Ideas for more powerful scripts</div></blockquote>
<hr class="docutils" />
<ul>
<li><p class="first">You have a problem that you want to solve by writing a Bash script.
Unfortunately, you don&#8217;t know quite where to start. One method is to
plunge right in and code those parts of the script that come easily,
and write the hard parts as <em>pseudo-code</em> .</p>
<div class="highlight-sh"><div class="highlight"><pre><span class="c">#!/bin/bash</span>

<span class="nv">ARGCOUNT</span><span class="o">=</span><span class="m">1</span>                     <span class="c"># Need name as argument.</span>
<span class="nv">E_WRONGARGS</span><span class="o">=</span>65

<span class="k">if</span> <span class="o">[</span> number-of-arguments is-not-equal-to <span class="s2">&quot;</span><span class="nv">$ARGCOUNT</span><span class="s2">&quot;</span> <span class="o">]</span>
<span class="c">#    ^^^^^^^^^^^^^^^^^^^ ^^^^^^^^^^^^^^^</span>
<span class="c">#  Can&#39;t figure out how to code this . . .</span>
<span class="c">#+ . . . so write it in pseudo-code.</span>

<span class="k">then</span>
  <span class="nb">echo</span> <span class="s2">&quot;Usage: name-of-script name&quot;</span>
  <span class="c">#            ^^^^^^^^^^^^^^     More pseudo-code.</span>
  <span class="nb">exit</span> <span class="nv">$E_WRONGARGS</span>
<span class="k">fi</span>

. . .

<span class="nb">exit </span>0


<span class="c"># Later on, substitute working code for the pseudo-code.</span>

<span class="c"># Line 6 becomes:</span>
<span class="k">if</span> <span class="o">[</span> <span class="nv">$# </span>-ne <span class="s2">&quot;</span><span class="nv">$ARGCOUNT</span><span class="s2">&quot;</span> <span class="o">]</span>

<span class="c"># Line 12 becomes:</span>
  <span class="nb">echo</span> <span class="s2">&quot;Usage: `basename </span><span class="nv">$0</span><span class="s2">` name&quot;</span>
</pre></div>
</div>
<p>For an example of using pseudo-code, see the <a class="reference external" href="writingscripts.html#NEWTONSQRT">Square
Root</a> exercise.</p>
</li>
<li><p class="first">To keep a record of which user scripts have run during a particular
session or over a number of sessions, add the following lines to each
script you want to keep track of. This will keep a continuing file
record of the script names and invocation times.</p>
<div class="highlight-sh"><div class="highlight"><pre><span class="c"># Append (&gt;&gt;) following to end of each script tracked.</span>

whoami&gt;&gt; <span class="nv">$SAVE_FILE</span>    <span class="c"># User invoking the script.</span>
<span class="nb">echo</span> <span class="nv">$0</span>&gt;&gt; <span class="nv">$SAVE_FILE</span>   <span class="c"># Script name.</span>
date&gt;&gt; <span class="nv">$SAVE_FILE</span>      <span class="c"># Date and time.</span>
<span class="nb">echo</span>&gt;&gt; <span class="nv">$SAVE_FILE</span>      <span class="c"># Blank line as separator.</span>

<span class="c">#  Of course, SAVE_FILE defined and exported as environmental variable in ~/.bashrc</span>
<span class="c">#+ (something like ~/.scripts-run)</span>
</pre></div>
</div>
</li>
<li><p class="first">The &gt;&gt; operator <em>appends</em> lines to a file. What if you wish to
<em>prepend</em> a line to an existing file, that is, to paste it in at the
beginning?</p>
<div class="highlight-sh"><div class="highlight"><pre><span class="nv">file</span><span class="o">=</span>data.txt
<span class="nv">title</span><span class="o">=</span><span class="s2">&quot;***This is the title line of data text file***&quot;</span>

<span class="nb">echo</span> <span class="nv">$titlecat</span> - <span class="nv">$file</span> &gt;<span class="nv">$file</span>.new
<span class="c"># &quot;cat -&quot; concatenates stdout to $file.</span>
<span class="c">#  End result is</span>
<span class="c">#+ to write a new file with $title appended at *beginning*.</span>
</pre></div>
</div>
<p>This is a simplified variant of the <a class="reference external" href="x17837.html#PREPENDEX">Example
19-13</a> script given earlier. And, of
course, <a class="reference external" href="sedawk.html#SEDREF">sed</a> can also do this.</p>
</li>
<li><p class="first">A shell script may act as an embedded command inside another shell
script, a <em>Tcl</em> or <em>wish</em> script, or even a
<a class="reference external" href="filearchiv.html#MAKEFILEREF">Makefile</a> . It can be invoked as an
external shell command in a C program using the
``                   system()                 `` call, i.e.,
``                   system(&#8220;script_name&#8221;);                 `` .</p>
</li>
<li><p class="first">Setting a variable to the contents of an embedded <em>sed</em> or <em>awk</em>
script increases the readability of the surrounding <a class="reference external" href="wrapper.html#SHWRAPPER">shell
wrapper</a> . See <a class="reference external" href="contributed-scripts.html#MAILFORMAT">Example
A-1</a> and <a class="reference external" href="internal.html#COLTOTALER3">Example
15-20</a> .</p>
</li>
<li><p class="first">Put together files containing your favorite and most useful
definitions and functions. As necessary, &#8220;include&#8221; one or more of
these &#8220;library files&#8221; in scripts with either the
<a class="reference external" href="special-chars.html#DOTREF">dot</a> ( <strong>.</strong> ) or
<a class="reference external" href="internal.html#SOURCEREF">source</a> command.</p>
<div class="highlight-sh"><div class="highlight"><pre><span class="c"># SCRIPT LIBRARY</span>
<span class="c"># ------ -------</span>

<span class="c"># Note:</span>
<span class="c"># No &quot;#!&quot; here.</span>
<span class="c"># No &quot;live code&quot; either.</span>


<span class="c"># Useful variable definitions</span>

<span class="nv">ROOT_UID</span><span class="o">=</span><span class="m">0</span>             <span class="c"># Root has $UID 0.</span>
<span class="nv">E_NOTROOT</span><span class="o">=</span><span class="m">101</span>          <span class="c"># Not root user error.</span>
<span class="nv">MAXRETVAL</span><span class="o">=</span><span class="m">255</span>          <span class="c"># Maximum (positive) return value of a function.</span>
<span class="nv">SUCCESS</span><span class="o">=</span>0
<span class="nv">FAILURE</span><span class="o">=</span>-1



<span class="c"># Functions</span>

Usage <span class="o">()</span>               <span class="c"># &quot;Usage:&quot; message.</span>
<span class="o">{</span>
  <span class="k">if</span> <span class="o">[</span> -z <span class="s2">&quot;</span><span class="nv">$1</span><span class="s2">&quot;</span> <span class="o">]</span>       <span class="c"># No arg passed.</span>
  <span class="k">then</span>
    <span class="nv">msg</span><span class="o">=</span>filename
  <span class="k">else</span>
    <span class="nv">msg</span><span class="o">=</span><span class="nv">$@</span>
  <span class="k">fi</span>

  <span class="nb">echo</span> <span class="s2">&quot;Usage: `basename </span><span class="nv">$0</span><span class="s2">` &quot;</span><span class="nv">$msg</span><span class="s2">&quot;&quot;</span>
<span class="o">}</span>


Check_if_root <span class="o">()</span>       <span class="c"># Check if root running script.</span>
<span class="o">{</span>                      <span class="c"># From &quot;ex39.sh&quot; example.</span>
  <span class="k">if</span> <span class="o">[</span> <span class="s2">&quot;</span><span class="nv">$UID</span><span class="s2">&quot;</span> -ne <span class="s2">&quot;</span><span class="nv">$ROOT_UID</span><span class="s2">&quot;</span> <span class="o">]</span>
  <span class="k">then</span>
    <span class="nb">echo</span> <span class="s2">&quot;Must be root to run this script.&quot;</span>
    <span class="nb">exit</span> <span class="nv">$E_NOTROOT</span>
  <span class="k">fi</span>
<span class="o">}</span>


CreateTempfileName <span class="o">()</span>  <span class="c"># Creates a &quot;unique&quot; temp filename.</span>
<span class="o">{</span>                      <span class="c"># From &quot;ex51.sh&quot; example.</span>
  <span class="nv">prefix</span><span class="o">=</span>temp
  <span class="nv">suffix</span><span class="o">=</span><span class="sb">`</span><span class="nb">eval </span>date +%s<span class="sb">`</span>
  <span class="nv">Tempfilename</span><span class="o">=</span><span class="nv">$prefix</span>.<span class="nv">$suffix</span>
<span class="o">}</span>


isalpha2 <span class="o">()</span>            <span class="c"># Tests whether *entire string* is alphabetic.</span>
<span class="o">{</span>                      <span class="c"># From &quot;isalpha.sh&quot; example.</span>
  <span class="o">[</span> <span class="nv">$# </span>-eq <span class="m">1</span> <span class="o">]</span> <span class="p">|</span><span class="k">return</span> <span class="nv">$FAILURE</span>

  <span class="k">case</span> <span class="nv">$1</span> in
  *<span class="o">[</span>!a-zA-Z<span class="o">]</span>*<span class="p">|</span><span class="s2">&quot;&quot;</span><span class="o">)</span> <span class="k">return</span> <span class="nv">$FAILURE</span><span class="p">;;</span>
  *<span class="o">)</span> <span class="k">return</span> <span class="nv">$SUCCESS</span><span class="p">;;</span>
  <span class="k">esac</span>                 <span class="c"># Thanks, S.C.</span>
<span class="o">}</span>


abs <span class="o">()</span>                           <span class="c"># Absolute value.</span>
<span class="o">{</span>                                <span class="c"># Caution: Max return value = 255.</span>
  <span class="nv">E_ARGERR</span><span class="o">=</span>-999999

  <span class="k">if</span> <span class="o">[</span> -z <span class="s2">&quot;</span><span class="nv">$1</span><span class="s2">&quot;</span> <span class="o">]</span>                 <span class="c"># Need arg passed.</span>
  <span class="k">then</span>
    <span class="k">return</span> <span class="nv">$E_ARGERR</span>             <span class="c"># Obvious error value returned.</span>
  <span class="k">fi</span>

  <span class="k">if</span> <span class="o">[</span> <span class="s2">&quot;</span><span class="nv">$1</span><span class="s2">&quot;</span> -ge <span class="m">0</span> <span class="o">]</span>              <span class="c"># If non-negative,</span>
  <span class="k">then</span>                           <span class="c">#</span>
    <span class="nv">absval</span><span class="o">=</span><span class="nv">$1</span>                    <span class="c"># stays as-is.</span>
  <span class="k">else</span>                           <span class="c"># Otherwise,</span>
    <span class="nb">let</span> <span class="s2">&quot;absval = (( 0 - </span><span class="nv">$1</span><span class="s2"> ))&quot;</span>  <span class="c"># change sign.</span>
  <span class="k">fi</span>

  <span class="k">return</span> <span class="nv">$absval</span>
<span class="o">}</span>


tolower <span class="o">()</span>             <span class="c">#  Converts string(s) passed as argument(s)</span>
<span class="o">{</span>                      <span class="c">#+ to lowercase.</span>

  <span class="k">if</span> <span class="o">[</span> -z <span class="s2">&quot;</span><span class="nv">$1</span><span class="s2">&quot;</span> <span class="o">]</span>       <span class="c">#  If no argument(s) passed,</span>
  <span class="k">then</span>                 <span class="c">#+ send error message</span>
    <span class="nb">echo</span> <span class="s2">&quot;(null)&quot;</span>      <span class="c">#+ (C-style void-pointer error message)</span>
    <span class="k">return</span>             <span class="c">#+ and return from function.</span>
  <span class="k">fi</span>

  <span class="nb">echo</span> <span class="s2">&quot;</span><span class="nv">$@</span><span class="s2">&quot;</span>tr A-Z a-z
  <span class="c"># Translate all passed arguments ($@).</span>

  <span class="k">return</span>

<span class="c"># Use command substitution to set a variable to function output.</span>
<span class="c"># For example:</span>
<span class="c">#    oldvar=&quot;A seT of miXed-caSe LEtTerS&quot;</span>
<span class="c">#    newvar=`tolower &quot;$oldvar&quot;`</span>
<span class="c">#    echo &quot;$newvar&quot;    # a set of mixed-case letters</span>
<span class="c">#</span>
<span class="c"># Exercise: Rewrite this function to change lowercase passed argument(s)</span>
<span class="c">#           to uppercase ... toupper()  [easy].</span>
<span class="o">}</span>
</pre></div>
</div>
</li>
<li><p class="first">Use special-purpose comment headers to increase clarity and
legibility in scripts.</p>
<div class="highlight-sh"><div class="highlight"><pre><span class="c">## Caution.</span>
rm -rf *.zzy   <span class="c">##  The &quot;-rf&quot; options to &quot;rm&quot; are very dangerous,</span>
               <span class="c">##+ especially with wild cards.</span>

<span class="c">#+ Line continuation.</span>
<span class="c">#  This is line 1</span>
<span class="c">#+ of a multi-line comment,</span>
<span class="c">#+ and this is the final line.</span>

<span class="c">#* Note.</span>

<span class="c">#o List item.</span>

<span class="c">#&gt; Another point of view.</span>
<span class="k">while</span> <span class="o">[</span> <span class="s2">&quot;</span><span class="nv">$var1</span><span class="s2">&quot;</span> !<span class="o">=</span> <span class="s2">&quot;end&quot;</span> <span class="o">]</span>    <span class="c">#&gt; while test &quot;$var1&quot; != &quot;end&quot;</span>
</pre></div>
</div>
</li>
<li><p class="first">Dotan Barak contributes template code for a <em>progress bar</em> in a
script.</p>
</li>
</ul>
<div class="section" id="exemple-17-a-progress-bar">
<h2>Exemple 17. A Progress Bar<a class="headerlink" href="#exemple-17-a-progress-bar" title="Link permanent a aquest títol">¶</a></h2>
<blockquote>
<div><div class="highlight-sh"><div class="highlight"><pre><span class="c">#!/bin/bash</span>
<span class="c"># progress-bar.sh</span>

<span class="c"># Author: Dotan Barak (very minor revisions by ABS Guide author).</span>
<span class="c"># Used in ABS Guide with permission (thanks!).</span>


<span class="nv">BAR_WIDTH</span><span class="o">=</span>50
<span class="nv">BAR_CHAR_START</span><span class="o">=</span><span class="s2">&quot;[&quot;</span>
<span class="nv">BAR_CHAR_END</span><span class="o">=</span><span class="s2">&quot;]&quot;</span>
<span class="nv">BAR_CHAR_EMPTY</span><span class="o">=</span><span class="s2">&quot;.&quot;</span>
<span class="nv">BAR_CHAR_FULL</span><span class="o">=</span><span class="s2">&quot;=&quot;</span>
<span class="nv">BRACKET_CHARS</span><span class="o">=</span>2
<span class="nv">LIMIT</span><span class="o">=</span>100

print_progress_bar<span class="o">()</span>
<span class="o">{</span>
        <span class="c"># Calculate how many characters will be full.</span>
        <span class="nb">let</span> <span class="s2">&quot;full_limit = (((</span><span class="nv">$1</span><span class="s2"> - </span><span class="nv">$BRACKET_CHARS</span><span class="s2">) * </span><span class="nv">$2</span><span class="s2">) / </span><span class="nv">$LIMIT</span><span class="s2">)&quot;</span>

        <span class="c"># Calculate how many characters will be empty.</span>
        <span class="nb">let</span> <span class="s2">&quot;empty_limit = (</span><span class="nv">$1</span><span class="s2"> - </span><span class="nv">$BRACKET_CHARS</span><span class="s2">) - </span><span class="si">${</span><span class="nv">full_limit</span><span class="si">}</span><span class="s2">&quot;</span>

        <span class="c"># Prepare the bar.</span>
        <span class="nv">bar_line</span><span class="o">=</span><span class="s2">&quot;</span><span class="si">${</span><span class="nv">BAR_CHAR_START</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="k">for</span> <span class="o">((</span><span class="nv">j</span><span class="o">=</span>0<span class="p">;</span> j&lt;full_limit<span class="p">;</span> j++<span class="o">))</span><span class="p">;</span> <span class="k">do</span>
                <span class="nv">bar_line</span><span class="o">=</span><span class="s2">&quot;</span><span class="si">${</span><span class="nv">bar_line</span><span class="si">}${</span><span class="nv">BAR_CHAR_FULL</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="k">done</span>

        <span class="k">for</span> <span class="o">((</span><span class="nv">j</span><span class="o">=</span>0<span class="p">;</span> j&lt;empty_limit<span class="p">;</span> j++<span class="o">))</span><span class="p">;</span> <span class="k">do</span>
                <span class="nv">bar_line</span><span class="o">=</span><span class="s2">&quot;</span><span class="si">${</span><span class="nv">bar_line</span><span class="si">}${</span><span class="nv">BAR_CHAR_EMPTY</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="k">done</span>

        <span class="nv">bar_line</span><span class="o">=</span><span class="s2">&quot;</span><span class="si">${</span><span class="nv">bar_line</span><span class="si">}${</span><span class="nv">BAR_CHAR_END</span><span class="si">}</span><span class="s2">&quot;</span>

        <span class="nb">printf</span> <span class="s2">&quot;%3d%% %s&quot;</span> <span class="nv">$2</span> <span class="si">${</span><span class="nv">bar_line</span><span class="si">}</span>
<span class="o">}</span>

<span class="c"># Here is a sample of code that uses it.</span>
<span class="nv">MAX_PERCENT</span><span class="o">=</span>100
<span class="k">for</span> <span class="o">((</span><span class="nv">i</span><span class="o">=</span>0<span class="p">;</span> i&lt;<span class="o">=</span>MAX_PERCENT<span class="p">;</span> i++<span class="o">))</span><span class="p">;</span> <span class="k">do</span>
        <span class="c">#</span>
        usleep 10000
        <span class="c"># ... Or run some other commands ...</span>
        <span class="c">#</span>
        print_progress_bar <span class="si">${</span><span class="nv">BAR_WIDTH</span><span class="si">}</span> <span class="si">${</span><span class="nv">i</span><span class="si">}</span>
        <span class="nb">echo</span> -en <span class="s2">&quot;\r&quot;</span>
<span class="k">done</span>

<span class="nb">echo</span> <span class="s2">&quot;&quot;</span>

<span class="nb">exit</span>
</pre></div>
</div>
</div></blockquote>
<ul>
<li><p class="first">A particularly clever use of
<a class="reference external" href="testconstructs.html#TESTCONSTRUCTS1">if-test</a> constructs is for
comment blocks.</p>
<div class="highlight-sh"><div class="highlight"><pre><span class="c">#!/bin/bash</span>

<span class="nv">COMMENT_BLOCK</span><span class="o">=</span>
<span class="c">#  Try setting the above variable to some value</span>
<span class="c">#+ for an unpleasant surprise.</span>

<span class="k">if</span> <span class="o">[</span> <span class="nv">$COMMENT_BLOCK</span> <span class="o">]</span><span class="p">;</span> <span class="k">then</span>

Comment block --
<span class="o">=================================</span>
This is a comment line.
This is another comment line.
This is yet another comment line.
<span class="o">=================================</span>

<span class="nb">echo</span> <span class="s2">&quot;This will not echo.&quot;</span>

Comment blocks are error-free! Whee!

<span class="k">fi</span>

<span class="nb">echo</span> <span class="s2">&quot;No more comments, please.&quot;</span>

<span class="nb">exit </span>0
</pre></div>
</div>
<p>Compare this with <a class="reference external" href="here-docs.html#CBLOCK1">using here documents to comment out code
blocks</a> .</p>
</li>
<li><p class="first">Using the <a class="reference external" href="internalvariables.html#XSTATVARREF">$? exit status
variable</a> , a script may test
if a parameter contains only digits, so it can be treated as an
integer.</p>
<div class="highlight-sh"><div class="highlight"><pre><span class="c">#!/bin/bash</span>

<span class="nv">SUCCESS</span><span class="o">=</span>0
<span class="nv">E_BADINPUT</span><span class="o">=</span>85

<span class="nb">test</span> <span class="s2">&quot;</span><span class="nv">$1</span><span class="s2">&quot;</span> -ne <span class="m">0</span> -o <span class="s2">&quot;</span><span class="nv">$1</span><span class="s2">&quot;</span> -eq <span class="m">0</span> 2&gt;/dev/null
<span class="c"># An integer is either equal to 0 or not equal to 0.</span>
<span class="c"># 2&gt;/dev/null suppresses error message.</span>

<span class="k">if</span> <span class="o">[</span> <span class="nv">$?</span> -ne <span class="s2">&quot;</span><span class="nv">$SUCCESS</span><span class="s2">&quot;</span> <span class="o">]</span>
<span class="k">then</span>
  <span class="nb">echo</span> <span class="s2">&quot;Usage: `basename </span><span class="nv">$0</span><span class="s2">` integer-input&quot;</span>
  <span class="nb">exit</span> <span class="nv">$E_BADINPUT</span>
<span class="k">fi</span>

<span class="nb">let</span> <span class="s2">&quot;sum = </span><span class="nv">$1</span><span class="s2"> + 25&quot;</span>             <span class="c"># Would give error if $1 not integer.</span>
<span class="nb">echo</span> <span class="s2">&quot;Sum = </span><span class="nv">$sum</span><span class="s2">&quot;</span>

<span class="c"># Any variable, not just a command-line parameter, can be tested this way.</span>

<span class="nb">exit </span>0
</pre></div>
</div>
</li>
<li><p class="first">The 0 - 255 range for function return values is a severe limitation.</p>
</li>
</ul>
<blockquote>
<div>Global variables and other workarounds are often problematic. An
alternative method for a function to communicate a value back to the
main body of the script is to have the function write to
``         stdout        `` (usually with
<a class="reference external" href="internal.html#ECHOREF">echo</a> ) the &#8220;return value,&#8221; and assign
this to a variable. This is actually a variant of <a class="reference external" href="commandsub.html#COMMANDSUBREF">command
substitution.</a></div></blockquote>
</div>
<div class="section" id="exemple-18-return-value-trickery">
<h2>Exemple 18. Return value trickery<a class="headerlink" href="#exemple-18-return-value-trickery" title="Link permanent a aquest títol">¶</a></h2>
<blockquote>
<div><div class="highlight-sh"><div class="highlight"><pre><span class="c">#!/bin/bash</span>
<span class="c"># multiplication.sh</span>

multiply <span class="o">()</span>                     <span class="c"># Multiplies params passed.</span>
<span class="o">{</span>                               <span class="c"># Will accept a variable number of args.</span>

  <span class="nb">local </span><span class="nv">product</span><span class="o">=</span>1

  <span class="k">until</span> <span class="o">[</span> -z <span class="s2">&quot;</span><span class="nv">$1</span><span class="s2">&quot;</span> <span class="o">]</span>             <span class="c"># Until uses up arguments passed...</span>
  <span class="k">do</span>
    <span class="nb">let</span> <span class="s2">&quot;product *= </span><span class="nv">$1</span><span class="s2">&quot;</span>
    <span class="nb">shift</span>
<span class="nb">  </span><span class="k">done</span>

  <span class="nb">echo</span> <span class="nv">$product</span>                 <span class="c">#  Will not echo to stdout,</span>
<span class="o">}</span>                               <span class="c">#+ since this will be assigned to a variable.</span>

<span class="nv">mult1</span><span class="o">=</span>15383<span class="p">;</span> <span class="nv">mult2</span><span class="o">=</span>25211
<span class="nv">val1</span><span class="o">=</span><span class="sb">`</span>multiply <span class="nv">$mult1</span> <span class="nv">$mult2</span><span class="sb">`</span>
<span class="c"># Assigns stdout (echo) of function to the variable val1.</span>
<span class="nb">echo</span> <span class="s2">&quot;</span><span class="nv">$mult1</span><span class="s2"> X </span><span class="nv">$mult2</span><span class="s2"> = </span><span class="nv">$val1</span><span class="s2">&quot;</span>                   <span class="c"># 387820813</span>

<span class="nv">mult1</span><span class="o">=</span>25<span class="p">;</span> <span class="nv">mult2</span><span class="o">=</span>5<span class="p">;</span> <span class="nv">mult3</span><span class="o">=</span>20
<span class="nv">val2</span><span class="o">=</span><span class="sb">`</span>multiply <span class="nv">$mult1</span> <span class="nv">$mult2</span> <span class="nv">$mult3</span><span class="sb">`</span>
<span class="nb">echo</span> <span class="s2">&quot;</span><span class="nv">$mult1</span><span class="s2"> X </span><span class="nv">$mult2</span><span class="s2"> X </span><span class="nv">$mult3</span><span class="s2"> = </span><span class="nv">$val2</span><span class="s2">&quot;</span>          <span class="c"># 2500</span>

<span class="nv">mult1</span><span class="o">=</span>188<span class="p">;</span> <span class="nv">mult2</span><span class="o">=</span>37<span class="p">;</span> <span class="nv">mult3</span><span class="o">=</span>25<span class="p">;</span> <span class="nv">mult4</span><span class="o">=</span>47
<span class="nv">val3</span><span class="o">=</span><span class="sb">`</span>multiply <span class="nv">$mult1</span> <span class="nv">$mult2</span> <span class="nv">$mult3</span> <span class="nv">$mult4</span><span class="sb">`</span>
<span class="nb">echo</span> <span class="s2">&quot;</span><span class="nv">$mult1</span><span class="s2"> X </span><span class="nv">$mult2</span><span class="s2"> X </span><span class="nv">$mult3</span><span class="s2"> X </span><span class="nv">$mult4</span><span class="s2"> = </span><span class="nv">$val3</span><span class="s2">&quot;</span> <span class="c"># 8173300</span>

<span class="nb">exit </span>0
</pre></div>
</div>
<p>The same technique also works for alphanumeric strings. This means
that a function can &#8220;return&#8221; a non-numeric value.</p>
<div class="highlight-sh"><div class="highlight"><pre>capitalize_ichar <span class="o">()</span>          <span class="c">#  Capitalizes initial character</span>
<span class="o">{</span>                            <span class="c">#+ of argument string(s) passed.</span>

  <span class="nv">string0</span><span class="o">=</span><span class="s2">&quot;</span><span class="nv">$@</span><span class="s2">&quot;</span>               <span class="c"># Accepts multiple arguments.</span>

  <span class="nv">firstchar</span><span class="o">=</span><span class="si">${</span><span class="nv">string0</span><span class="p">:</span><span class="nv">0</span><span class="p">:</span><span class="nv">1</span><span class="si">}</span>   <span class="c"># First character.</span>
  <span class="nv">string1</span><span class="o">=</span><span class="si">${</span><span class="nv">string0</span><span class="p">:</span><span class="nv">1</span><span class="si">}</span>       <span class="c"># Rest of string(s).</span>

  <span class="nv">FirstChar</span><span class="o">=</span><span class="sb">`</span><span class="nb">echo</span> <span class="s2">&quot;</span><span class="nv">$firstchar</span><span class="s2">&quot;</span>tr a-z A-Z<span class="sb">`</span>
                             <span class="c"># Capitalize first character.</span>

  <span class="nb">echo</span> <span class="s2">&quot;</span><span class="nv">$FirstChar$string1</span><span class="s2">&quot;</span>  <span class="c"># Output to stdout.</span>

<span class="o">}</span>

<span class="nv">newstring</span><span class="o">=</span><span class="sb">`</span>capitalize_ichar <span class="s2">&quot;every sentence should start with a capital letter.&quot;</span><span class="sb">`</span>
<span class="nb">echo</span> <span class="s2">&quot;</span><span class="nv">$newstring</span><span class="s2">&quot;</span>          <span class="c"># Every sentence should start with a capital letter.</span>
</pre></div>
</div>
<p>It is even possible for a function to &#8220;return&#8221; multiple values with
this method.</p>
</div></blockquote>
</div>
<div class="section" id="exemple-19-even-more-return-value-trickery">
<h2>Exemple 19. Even more return value trickery<a class="headerlink" href="#exemple-19-even-more-return-value-trickery" title="Link permanent a aquest títol">¶</a></h2>
<blockquote>
<div><div class="highlight-sh"><div class="highlight"><pre><span class="c">#!/bin/bash</span>
<span class="c"># sum-product.sh</span>
<span class="c"># A function may &quot;return&quot; more than one value.</span>

sum_and_product <span class="o">()</span>   <span class="c"># Calculates both sum and product of passed args.</span>
<span class="o">{</span>
  <span class="nb">echo</span> <span class="k">$((</span> <span class="nv">$1</span> <span class="o">+</span> <span class="nv">$2</span> <span class="k">))</span> <span class="k">$((</span> <span class="nv">$1</span> <span class="o">*</span> <span class="nv">$2</span> <span class="k">))</span>
<span class="c"># Echoes to stdout each calculated value, separated by space.</span>
<span class="o">}</span>

<span class="nb">echo</span>
<span class="nb">echo</span> <span class="s2">&quot;Enter first number &quot;</span>
<span class="nb">read </span>first

<span class="nb">echo</span>
<span class="nb">echo</span> <span class="s2">&quot;Enter second number &quot;</span>
<span class="nb">read </span>second
<span class="nb">echo</span>

<span class="nv">retval</span><span class="o">=</span><span class="sb">`</span>sum_and_product <span class="nv">$first</span> <span class="nv">$second</span><span class="sb">`</span>      <span class="c"># Assigns output of function.</span>
<span class="nv">sum</span><span class="o">=</span><span class="sb">`</span><span class="nb">echo</span> <span class="s2">&quot;</span><span class="nv">$retval</span><span class="s2">&quot;</span>awk <span class="s1">&#39;{print $1}&#39;</span><span class="sb">`</span>      <span class="c"># Assigns first field.</span>
<span class="nv">product</span><span class="o">=</span><span class="sb">`</span><span class="nb">echo</span> <span class="s2">&quot;</span><span class="nv">$retval</span><span class="s2">&quot;</span>awk <span class="s1">&#39;{print $2}&#39;</span><span class="sb">`</span>  <span class="c"># Assigns second field.</span>

<span class="nb">echo</span> <span class="s2">&quot;</span><span class="nv">$first</span><span class="s2"> + </span><span class="nv">$second</span><span class="s2"> = </span><span class="nv">$sum</span><span class="s2">&quot;</span>
<span class="nb">echo</span> <span class="s2">&quot;</span><span class="nv">$first</span><span class="s2"> * </span><span class="nv">$second</span><span class="s2"> = </span><span class="nv">$product</span><span class="s2">&quot;</span>
<span class="nb">echo</span>

<span class="nb">exit </span>0
</pre></div>
</div>
</div></blockquote>
<div class="admonition caution">
<p class="first admonition-title">Compte</p>
<blockquote>
<div>There can be only <strong>one</strong> <em>echo</em> statement in the function for this</div></blockquote>
<p class="last">to work. If you alter the previous example:</p>
</div>
<hr class="docutils" />
<div class="highlight-sh"><div class="highlight"><pre>    sum_and_product <span class="o">()</span>
    <span class="o">{</span>
      <span class="nb">echo</span> <span class="s2">&quot;This is the</span>
<span class="s2">sum_and_product function</span>
<span class="s2">.&quot;</span> <span class="c"># This messes things</span>
up!
      <span class="nb">echo</span> <span class="k">$((</span> <span class="nv">$1</span> <span class="o">+</span> <span class="nv">$2</span> <span class="o">)</span>
<span class="o">)</span> <span class="k">$((</span> <span class="nv">$1</span> <span class="o">*</span> <span class="nv">$2</span> <span class="k">))</span>
    <span class="o">}</span>
    ...
    <span class="nv">retval</span><span class="o">=</span><span class="sb">`</span>sum_and_prod
uct <span class="nv">$first</span> <span class="nv">$second</span><span class="sb">`</span>
 <span class="c"># Assigns output of fun</span>
ction.
    <span class="c"># Now, this will not</span>
 work correctly.
</pre></div>
</div>
<hr class="docutils" />
<blockquote>
<div><div class="highlight-sh"><div class="highlight"><pre>sum_and_product <span class="o">()</span>
<span class="o">{</span>
  <span class="nb">echo</span> <span class="s2">&quot;This is the sum_and_product function.&quot;</span> <span class="c"># This messes things up!</span>
  <span class="nb">echo</span> <span class="k">$((</span> <span class="nv">$1</span> <span class="o">+</span> <span class="nv">$2</span> <span class="k">))</span> <span class="k">$((</span> <span class="nv">$1</span> <span class="o">*</span> <span class="nv">$2</span> <span class="k">))</span>
<span class="o">}</span>
...
<span class="nv">retval</span><span class="o">=</span><span class="sb">`</span>sum_and_product <span class="nv">$first</span> <span class="nv">$second</span><span class="sb">`</span>      <span class="c"># Assigns output of function.</span>
<span class="c"># Now, this will not work correctly.</span>
</pre></div>
</div>
<div class="highlight-sh"><div class="highlight"><pre>sum_and_product <span class="o">()</span>
<span class="o">{</span>
  <span class="nb">echo</span> <span class="s2">&quot;This is the sum_and_product function.&quot;</span> <span class="c"># This messes things up!</span>
  <span class="nb">echo</span> <span class="k">$((</span> <span class="nv">$1</span> <span class="o">+</span> <span class="nv">$2</span> <span class="k">))</span> <span class="k">$((</span> <span class="nv">$1</span> <span class="o">*</span> <span class="nv">$2</span> <span class="k">))</span>
<span class="o">}</span>
...
<span class="nv">retval</span><span class="o">=</span><span class="sb">`</span>sum_and_product <span class="nv">$first</span> <span class="nv">$second</span><span class="sb">`</span>      <span class="c"># Assigns output of function.</span>
<span class="c"># Now, this will not work correctly.</span>
</pre></div>
</div>
</div></blockquote>
<ul>
<li><p class="first">Next in our bag of tricks are techniques for passing an
<a class="reference external" href="arrays.html#ARRAYREF">array</a> to a
<a class="reference external" href="functions.html#FUNCTIONREF">function</a> , then &#8220;returning&#8221; an array
back to the main body of the script.</p>
<p>Passing an array involves loading the space-separated elements of the
array into a variable with <a class="reference external" href="commandsub.html#COMMANDSUBREF">command
substitution</a> . Getting an array
back as the &#8220;return value&#8221; from a function uses the previously
mentioned strategem of <a class="reference external" href="internal.html#ECHOREF">echoing</a> the array
in the function, then invoking command substitution and the <strong>( ...
)</strong> operator to assign it to an array.</p>
</li>
</ul>
</div>
<div class="section" id="exemple-20-passing-and-returning-arrays">
<h2>Exemple 20. Passing and returning arrays<a class="headerlink" href="#exemple-20-passing-and-returning-arrays" title="Link permanent a aquest títol">¶</a></h2>
<blockquote>
<div><div class="highlight-sh"><div class="highlight"><pre><span class="c">#!/bin/bash</span>
<span class="c"># array-function.sh: Passing an array to a function and ...</span>
<span class="c">#                   &quot;returning&quot; an array from a function</span>


Pass_Array <span class="o">()</span>
<span class="o">{</span>
  <span class="nb">local </span>passed_array   <span class="c"># Local variable!</span>
  <span class="nv">passed_array</span><span class="o">=(</span> <span class="sb">`</span><span class="nb">echo</span> <span class="s2">&quot;</span><span class="nv">$1</span><span class="s2">&quot;</span><span class="sb">`</span> <span class="o">)</span>
  <span class="nb">echo</span> <span class="s2">&quot;</span><span class="si">${</span><span class="nv">passed_array</span><span class="p">[@]</span><span class="si">}</span><span class="s2">&quot;</span>
  <span class="c">#  List all the elements of the new array</span>
  <span class="c">#+ declared and set within the function.</span>
<span class="o">}</span>


<span class="nv">original_array</span><span class="o">=(</span> element1 element2 element3 element4 element5 <span class="o">)</span>

<span class="nb">echo</span>
<span class="nb">echo</span> <span class="s2">&quot;original_array = </span><span class="si">${</span><span class="nv">original_array</span><span class="p">[@]</span><span class="si">}</span><span class="s2">&quot;</span>
<span class="c">#                      List all elements of original array.</span>


<span class="c"># This is the trick that permits passing an array to a function.</span>
<span class="c"># **********************************</span>
<span class="nv">argument</span><span class="o">=</span><span class="sb">`</span><span class="nb">echo</span> <span class="si">${</span><span class="nv">original_array</span><span class="p">[@]</span><span class="si">}</span><span class="sb">`</span>
<span class="c"># **********************************</span>
<span class="c">#  Pack a variable</span>
<span class="c">#+ with all the space-separated elements of the original array.</span>
<span class="c">#</span>
<span class="c"># Attempting to just pass the array itself will not work.</span>


<span class="c"># This is the trick that allows grabbing an array as a &quot;return value&quot;.</span>
<span class="c"># *****************************************</span>
<span class="nv">returned_array</span><span class="o">=(</span> <span class="sb">`</span>Pass_Array <span class="s2">&quot;</span><span class="nv">$argument</span><span class="s2">&quot;</span><span class="sb">`</span> <span class="o">)</span>
<span class="c"># *****************************************</span>
<span class="c"># Assign &#39;echoed&#39; output of function to array variable.</span>

<span class="nb">echo</span> <span class="s2">&quot;returned_array = </span><span class="si">${</span><span class="nv">returned_array</span><span class="p">[@]</span><span class="si">}</span><span class="s2">&quot;</span>

<span class="nb">echo</span> <span class="s2">&quot;=============================================================&quot;</span>

<span class="c">#  Now, try it again,</span>
<span class="c">#+ attempting to access (list) the array from outside the function.</span>
Pass_Array <span class="s2">&quot;</span><span class="nv">$argument</span><span class="s2">&quot;</span>

<span class="c"># The function itself lists the array, but ...</span>
<span class="c">#+ accessing the array from outside the function is forbidden.</span>
<span class="nb">echo</span> <span class="s2">&quot;Passed array (within function) = </span><span class="si">${</span><span class="nv">passed_array</span><span class="p">[@]</span><span class="si">}</span><span class="s2">&quot;</span>
<span class="c"># NULL VALUE since the array is a variable local to the function.</span>

<span class="nb">echo</span>

<span class="c">############################################</span>

<span class="c"># And here is an even more explicit example:</span>

ret_array <span class="o">()</span>
<span class="o">{</span>
  <span class="k">for</span> element in <span class="o">{</span>11..20<span class="o">}</span>
  <span class="k">do</span>
    <span class="nb">echo</span> <span class="s2">&quot;</span><span class="nv">$element</span><span class="s2"> &quot;</span>   <span class="c">#  Echo individual elements</span>
  <span class="k">done</span>                 <span class="c">#+ of what will be assembled into an array.</span>
<span class="o">}</span>

<span class="nv">arr</span><span class="o">=(</span> <span class="k">$(</span>ret_array<span class="k">)</span> <span class="o">)</span>   <span class="c">#  Assemble into array.</span>

<span class="nb">echo</span> <span class="s2">&quot;Capturing array \&quot;arr\&quot; from function ret_array () ...&quot;</span>
<span class="nb">echo</span> <span class="s2">&quot;Third element of array \&quot;arr\&quot; is </span><span class="si">${</span><span class="nv">arr</span><span class="p">[2]</span><span class="si">}</span><span class="s2">.&quot;</span>   <span class="c"># 13  (zero-indexed)</span>
<span class="nb">echo</span> -n <span class="s2">&quot;Entire array is: &quot;</span>
<span class="nb">echo</span> <span class="si">${</span><span class="nv">arr</span><span class="p">[@]</span><span class="si">}</span>                <span class="c"># 11 12 13 14 15 16 17 18 19 20</span>

<span class="nb">echo</span>

<span class="nb">exit </span>0

<span class="c">#  Nathan Coulter points out that passing arrays with elements containing</span>
<span class="c">#+ whitespace breaks this example.</span>
</pre></div>
</div>
<p>For a more elaborate example of passing arrays to functions, see
<a class="reference external" href="contributed-scripts.html#LIFESLOW">Example A-10</a> .</p>
</div></blockquote>
<ul>
<li><p class="first">Using the <a class="reference external" href="dblparens.html">double-parentheses construct</a> , it is
possible to use C-style syntax for setting and
incrementing/decrementing variables and in
<a class="reference external" href="loops1.html#FORLOOPREF1">for</a> and
<a class="reference external" href="loops1.html#WHILELOOPREF">while</a> loops. See <a class="reference external" href="loops1.html#FORLOOPC">Example
11-13</a> and <a class="reference external" href="loops1.html#WHLOOPC">Example
11-18</a> .</p>
</li>
<li><p class="first">Setting the <a class="reference external" href="internalvariables.html#PATHREF">path</a> and
<a class="reference external" href="system.html#UMASKREF">umask</a> at the beginning of a script makes
it more <a class="reference external" href="portabilityissues.html">portable</a> &#8211; more likely to run
on a &#8220;foreign&#8221; machine whose user may have bollixed up the
``         $PATH        `` and <strong>umask</strong> .</p>
<div class="highlight-sh"><div class="highlight"><pre><span class="c">#!/bin/bash</span>
<span class="nv">PATH</span><span class="o">=</span>/bin:/usr/bin:/usr/local/bin <span class="p">;</span> <span class="nb">export </span>PATH
<span class="nb">umask </span><span class="m">022</span>   <span class="c"># Files that the script creates will have 755 permission.</span>

<span class="c"># Thanks to Ian D. Allen, for this tip.</span>
</pre></div>
</div>
</li>
<li><p class="first">A useful scripting technique is to <em>repeatedly</em> feed the output of a
filter (by piping) back to the <em>same filter</em> , but with a different
set of arguments and/or options. Especially suitable for this are
<a class="reference external" href="textproc.html#TRREF">tr</a> and <a class="reference external" href="textproc.html#GREPREF">grep</a> .</p>
<div class="highlight-sh"><div class="highlight"><pre><span class="c"># From &quot;wstrings.sh&quot; example.</span>

<span class="nv">wlist</span><span class="o">=</span><span class="sb">`</span>strings <span class="s2">&quot;</span><span class="nv">$1</span><span class="s2">&quot;</span>tr A-Z a-z <span class="p">|</span> tr <span class="s1">&#39;[:space:]&#39;</span> Z <span class="p">|</span> <span class="se">\</span>
tr -cs <span class="s1">&#39;[:alpha:]&#39;</span> Ztr -s <span class="s1">&#39;\173-\377&#39;</span> Z <span class="p">|</span> tr Z <span class="s1">&#39; &#39;</span><span class="sb">`</span>
</pre></div>
</div>
</li>
</ul>
</div>
<div class="section" id="exemple-21-fun-with-anagrams">
<h2>Exemple 21. Fun with anagrams<a class="headerlink" href="#exemple-21-fun-with-anagrams" title="Link permanent a aquest títol">¶</a></h2>
<blockquote>
<div><div class="highlight-sh"><div class="highlight"><pre><span class="c">#!/bin/bash</span>
<span class="c"># agram.sh: Playing games with anagrams.</span>

<span class="c"># Find anagrams of...</span>
<span class="nv">LETTERSET</span><span class="o">=</span>etaoinshrdlu
<span class="nv">FILTER</span><span class="o">=</span><span class="s1">&#39;.......&#39;</span>       <span class="c"># How many letters minimum?</span>
<span class="c">#       1234567</span>

anagram <span class="s2">&quot;</span><span class="nv">$LETTERSET</span><span class="s2">&quot;</span><span class="c"># Find all anagrams of the letterset...</span>
grep <span class="s2">&quot;</span><span class="nv">$FILTER</span><span class="s2">&quot;</span>      <span class="c"># With at least 7 letters,</span>
grep <span class="s1">&#39;^is&#39;</span>          <span class="c"># starting with &#39;is&#39;</span>
grep -v <span class="s1">&#39;s$&#39;</span>        <span class="c"># no plurals</span>
grep -v <span class="s1">&#39;ed$&#39;</span>          <span class="c"># no past tense verbs</span>
<span class="c"># Possible to add many combinations of conditions and filters.</span>

<span class="c">#  Uses &quot;anagram&quot; utility</span>
<span class="c">#+ that is part of the author&#39;s &quot;yawl&quot; word list package.</span>
<span class="c">#  http://ibiblio.org/pub/Linux/libs/yawl-0.3.2.tar.gz</span>
<span class="c">#  http://bash.deta.in/yawl-0.3.2.tar.gz</span>

<span class="nb">exit </span><span class="m">0</span>                 <span class="c"># End of code.</span>


bash<span class="nv">$ </span>sh agram.sh
islander
isolate
isolead
isotheral



<span class="c">#  Exercises:</span>
<span class="c">#  ---------</span>
<span class="c">#  Modify this script to take the LETTERSET as a command-line parameter.</span>
<span class="c">#  Parameterize the filters in lines 11 - 13 (as with $FILTER),</span>
<span class="c">#+ so that they can be specified by passing arguments to a function.</span>

<span class="c">#  For a slightly different approach to anagramming,</span>
<span class="c">#+ see the agram2.sh script.</span>
</pre></div>
</div>
<p>See also <a class="reference external" href="procref1.html#CONSTAT">Example 29-4</a> , <a class="reference external" href="textproc.html#CRYPTOQUOTE">Example
16-25</a> , and <a class="reference external" href="contributed-scripts.html#SOUNDEX">Example
A-9</a> .</p>
</div></blockquote>
<ul>
<li><p class="first">Use &#8221; <a class="reference external" href="here-docs.html#ANONHEREDOC0">anonymous here documents</a> &#8221; to
comment out blocks of code, to save having to individually comment
out each line with a # . See <a class="reference external" href="here-docs.html#COMMENTBLOCK">Example
19-11</a> .</p>
</li>
<li><p class="first">Running a script on a machine that relies on a command that might not
be installed is dangerous. Use <a class="reference external" href="filearchiv.html#WHATISREF">whatis</a>
to avoid potential problems with this.</p>
<div class="highlight-sh"><div class="highlight"><pre><span class="nv">CMD</span><span class="o">=</span>command1                 <span class="c"># First choice.</span>
<span class="nv">PlanB</span><span class="o">=</span>command2               <span class="c"># Fallback option.</span>

<span class="nv">command_test</span><span class="o">=</span><span class="k">$(</span>whatis <span class="s2">&quot;</span><span class="nv">$CMD</span><span class="s2">&quot;</span>grep <span class="s1">&#39;nothing appropriate&#39;</span><span class="k">)</span>
<span class="c">#  If &#39;command1&#39; not found on system , &#39;whatis&#39; will return</span>
<span class="c">#+ &quot;command1: nothing appropriate.&quot;</span>
<span class="c">#</span>
<span class="c">#  A safer alternative is:</span>
<span class="c">#     command_test=$(whereis &quot;$CMD&quot;grep \/)</span>
<span class="c">#  But then the sense of the following test would have to be reversed,</span>
<span class="c">#+ since the $command_test variable holds content only if</span>
<span class="c">#+ the $CMD exists on the system.</span>
<span class="c">#     (Thanks, bojster.)</span>


<span class="k">if</span> <span class="o">[[</span> -z <span class="s2">&quot;</span><span class="nv">$command_test</span><span class="s2">&quot;</span> <span class="o">]]</span>  <span class="c"># Check whether command present.</span>
<span class="k">then</span>
  <span class="nv">$CMD</span> option1 option2       <span class="c">#  Run command1 with options.</span>
<span class="k">else</span>                         <span class="c">#  Otherwise,</span>
  <span class="nv">$PlanB</span>                     <span class="c">#+ run command2.</span>
<span class="k">fi</span>
</pre></div>
</div>
</li>
<li><p class="first">An <a class="reference external" href="testconstructs.html#IFGREPREF">if-grep test</a> may not return
expected results in an error case, when text is output to
``         stderr        `` , rather that ``         stdout        ``
.</p>
<div class="highlight-sh"><div class="highlight"><pre><span class="k">if</span> ls -l nonexistent_filenamegrep -q <span class="s1">&#39;No such file or directory&#39;</span>
  <span class="k">then</span> <span class="nb">echo</span> <span class="s2">&quot;File \&quot;nonexistent_filename\&quot; does not exist.&quot;</span>
<span class="k">fi</span>
</pre></div>
</div>
<p><a class="reference external" href="io-redirection.html#IOREDIRREF">Redirecting</a>
``         stderr        `` to ``         stdout        `` fixes
this.</p>
<div class="highlight-sh"><div class="highlight"><pre><span class="k">if</span> ls -l nonexistent_filename 2&gt;<span class="p">&amp;</span>1grep -q <span class="s1">&#39;No such file or directory&#39;</span>
<span class="c">#                             ^^^^</span>
  <span class="k">then</span> <span class="nb">echo</span> <span class="s2">&quot;File \&quot;nonexistent_filename\&quot; does not exist.&quot;</span>
<span class="k">fi</span>

<span class="c"># Thanks, Chris Martin, for pointing this out.</span>
</pre></div>
</div>
</li>
<li><p class="first">If you absolutely must access a subshell variable outside the</p>
</li>
</ul>
<blockquote>
<div><p>subshell, here&#8217;s a way to do it.</p>
<div class="highlight-sh"><div class="highlight"><pre><span class="nv">TMPFILE</span><span class="o">=</span>tmpfile                  <span class="c"># Create a temp file to store the variable.</span>

<span class="o">(</span>   <span class="c"># Inside the subshell ...</span>
<span class="nv">inner_variable</span><span class="o">=</span>Inner
<span class="nb">echo</span> <span class="nv">$inner_variable</span>
<span class="nb">echo</span> <span class="nv">$inner_variable</span> &gt;&gt;<span class="nv">$TMPFILE</span>  <span class="c"># Append to temp file.</span>
<span class="o">)</span>

    <span class="c"># Outside the subshell ...</span>

<span class="nb">echo</span><span class="p">;</span> <span class="nb">echo</span> <span class="s2">&quot;-----&quot;</span><span class="p">;</span> <span class="nb">echo</span>
<span class="nb">echo</span> <span class="nv">$inner_variable</span>             <span class="c"># Null, as expected.</span>
<span class="nb">echo</span> <span class="s2">&quot;-----&quot;</span><span class="p">;</span> <span class="nb">echo</span>

<span class="c"># Now ...</span>
<span class="nb">read </span>inner_variable &lt;<span class="nv">$TMPFILE</span>    <span class="c"># Read back shell variable.</span>
rm -f <span class="s2">&quot;</span><span class="nv">$TMPFILE</span><span class="s2">&quot;</span>                 <span class="c"># Get rid of temp file.</span>
<span class="nb">echo</span> <span class="s2">&quot;</span><span class="nv">$inner_variable</span><span class="s2">&quot;</span>           <span class="c"># It&#39;s an ugly kludge, but it works.</span>
</pre></div>
</div>
</div></blockquote>
<ul>
<li><p class="first">The <a class="reference external" href="extmisc.html#RUNPARTSREF">run-parts</a> command is handy for
running a set of command scripts in a particular sequence, especially
in combination with <a class="reference external" href="system.html#CRONREF">cron</a> or
<a class="reference external" href="timedate.html#ATREF">at</a> .</p>
</li>
<li><blockquote class="first">
<div><p>For doing multiple revisions on a complex script, use the <em>rcs</em>
Revision Control System package.</p>
<p>Among other benefits of this is automatically updated ID header tags.
The <strong>co</strong> command in <em>rcs</em> does a parameter replacement of certain
reserved key words, for example, replacing
``                   # $Id$                 `` in a script with
something like:</p>
<div class="highlight-sh"><div class="highlight"><pre><span class="c"># $Id: hello-world.sh,v 1.1 2004/10/16 02:43:05 bozo Exp $</span>
</pre></div>
</div>
</div></blockquote>
<p>36.7.2. Widgets</p>
</li>
</ul>
<hr class="docutils" />
<p>It would be nice to be able to invoke X-Windows widgets from a shell
script. There happen to exist several packages that purport to do so,
namely <em>Xscript</em> , <em>Xmenu</em> , and <em>widtools</em> . The first two of these no
longer seem to be maintained. Fortunately, it is still possible to
obtain <em>widtools</em>
<a class="reference external" href="http://www.batse.msfc.nasa.gov/~mallozzi/home/software/xforms/src/widtools-2.0.tgz">here</a>
.</p>
<p><a href="#id1"><span class="problematic" id="id2">|</span></a>Caution</p>
<p>The <em>widtools</em> (widget tools) package requires the <em>XForms</em> library to
be installed. Additionally, the
<a class="reference external" href="filearchiv.html#MAKEFILEREF">Makefile</a> needs some judicious editing
before the package will build on a typical Linux system. Finally, three
of the six widgets offered do not work (and, in fact, segfault).</p>
<p>The <em>dialog</em> family of tools offers a method of calling &#8220;dialog&#8221; widgets
from a shell script. The original <em>dialog</em> utility works in a text
console, but its successors, <em>gdialog</em> , <em>Xdialog</em> , and <em>kdialog</em> use
X-Windows-based widget sets.</p>
</div>
<div class="section" id="exemple-22-widgets-invoked-from-a-shell-script">
<h2>Exemple 22. Widgets invoked from a shell script<a class="headerlink" href="#exemple-22-widgets-invoked-from-a-shell-script" title="Link permanent a aquest títol">¶</a></h2>
<div class="highlight-sh"><div class="highlight"><pre>   <span class="c">#!/bin/bash</span>
   <span class="c"># dialog.sh: Using &#39;gdialog&#39; widgets.</span>

   <span class="c"># Must have &#39;gdialog&#39; installed on your system to run this script.</span>
   <span class="c"># Or, you can replace all instance of &#39;gdialog&#39; below with &#39;kdialog&#39; ...</span>
   <span class="c"># Version 1.1 (corrected 04/05/05)</span>

   <span class="c"># This script was inspired by the following article.</span>
   <span class="c">#     &quot;Scripting for X Productivity,&quot; by Marco Fioretti,</span>
   <span class="c">#      LINUX JOURNAL, Issue 113, September 2003, pp. 86-9.</span>
   <span class="c"># Thank you, all you good people at LJ.</span>


   <span class="c"># Input error in dialog box.</span>
   <span class="nv">E_INPUT</span><span class="o">=</span>85
   <span class="c"># Dimensions of display, input widgets.</span>
   <span class="nv">HEIGHT</span><span class="o">=</span>50
   <span class="nv">WIDTH</span><span class="o">=</span>60

   <span class="c"># Output file name (constructed out of script name).</span>
   <span class="nv">OUTFILE</span><span class="o">=</span><span class="nv">$0</span>.output

   <span class="c"># Display this script in a text widget.</span>
   gdialog --title <span class="s2">&quot;Displaying: </span><span class="nv">$0</span><span class="s2">&quot;</span> --textbox <span class="nv">$0</span> <span class="nv">$HEIGHT</span> <span class="nv">$WIDTH</span>



   <span class="c"># Now, we&#39;ll try saving input in a file.</span>
   <span class="nb">echo</span> -n <span class="s2">&quot;VARIABLE=&quot;</span> &gt; <span class="nv">$OUTFILE</span>
   gdialog --title <span class="s2">&quot;User Input&quot;</span> --inputbox <span class="s2">&quot;Enter variable, please:&quot;</span> <span class="se">\</span>
   <span class="nv">$HEIGHT</span> <span class="nv">$WIDTH</span> 2&gt;&gt; <span class="nv">$OUTFILE</span>


   <span class="k">if</span> <span class="o">[</span> <span class="s2">&quot;</span><span class="nv">$?</span><span class="s2">&quot;</span> -eq <span class="m">0</span> <span class="o">]</span>
   <span class="c"># It&#39;s good practice to check exit status.</span>
   <span class="k">then</span>
     <span class="nb">echo</span> <span class="s2">&quot;Executed \&quot;dialog box\&quot; without errors.&quot;</span>
   <span class="k">else</span>
     <span class="nb">echo</span> <span class="s2">&quot;Error(s) in \&quot;dialog box\&quot; execution.&quot;</span>
           <span class="c"># Or, clicked on &quot;Cancel&quot;, instead of &quot;OK&quot; button.</span>
     rm <span class="nv">$OUTFILE</span>
     <span class="nb">exit</span> <span class="nv">$E_INPUT</span>
   <span class="k">fi</span>



   <span class="c"># Now, we&#39;ll retrieve and display the saved variable.</span>
   . <span class="nv">$OUTFILE</span>   <span class="c"># &#39;Source&#39; the saved file.</span>
   <span class="nb">echo</span> <span class="s2">&quot;The variable input in the \&quot;input box\&quot; was: &quot;</span><span class="nv">$VARIABLE</span><span class="s2">&quot;&quot;</span>


   rm <span class="nv">$OUTFILE</span>  <span class="c"># Clean up by removing the temp file.</span>
                <span class="c"># Some applications may need to retain this file.</span>

   <span class="nb">exit</span> <span class="nv">$?</span>

   <span class="c"># Exercise: Rewrite this script using the &#39;zenity&#39; widget set.</span>




The <span class="sb">`</span>xmessage &lt;extmisc.html#XMESSAGEREF&gt;<span class="sb">`</span>__ <span class="nb">command </span>is a simple method
</pre></div>
</div>
<p>of popping up a message/query window. For example:</p>
<div class="highlight-sh"><div class="highlight"><pre>   xmessage Fatal error in script! -button <span class="nb">exit</span>



The latest entry in the widget sweepstakes is
</pre></div>
</div>
<p><a class="reference external" href="extmisc.html#ZENITYREF">zenity</a> . This utility pops up <em>GTK+</em> dialog
widgets-and-windows, and it works very nicely within a script.</p>
<div class="highlight-sh"><div class="highlight"><pre>get_info <span class="o">()</span>
<span class="o">{</span>
  zenity --entry       <span class="c">#  Pops up query window . . .</span>
                       <span class="c">#+ and prints user entry to stdout.</span>

                       <span class="c">#  Also try the --calendar and --scale options.</span>
<span class="o">}</span>

<span class="nv">answer</span><span class="o">=</span><span class="k">$(</span> get_info <span class="k">)</span>   <span class="c">#  Capture stdout in $answer variable.</span>

<span class="nb">echo</span> <span class="s2">&quot;User entered: &quot;</span><span class="nv">$answer</span><span class="s2">&quot;&quot;</span>
</pre></div>
</div>
<p>For other methods of scripting with widgets, try <em>Tk</em> or <em>wish</em> ( <em>Tcl</em>
derivatives), <em>PerlTk</em> ( <em>Perl</em> with <em>Tk</em> extensions), <em>tksh</em> ( <em>ksh</em>
with <em>Tk</em> extensions), <em>XForms4Perl</em> ( <em>Perl</em> with <em>XForms</em> extensions),
<em>Gtk-Perl</em> ( <em>Perl</em> with <em>Gtk</em> extensions), or <em>PyQt</em> ( <em>Python</em> with
<em>Qt</em> extensions).</p>
</div>
</div>


          </div>
          <footer>
  <hr/>

  

  <div role="contentinfo">
    <p>
    </p>
  </div>
      Pàgina generada amb <a href="http://sphinx-doc.org/">Sphinx</a> amb una lleugera
                                     variació del tema<a
                                     href="https://github.com/snide/sphinx_rtd_theme">
                                         sphinx-rtd-theme </a>.

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'./',
            VERSION:'10 març de 2014',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true
        };
    </script>
      <script type="text/javascript" src="_static/jquery.js"></script>
      <script type="text/javascript" src="_static/underscore.js"></script>
      <script type="text/javascript" src="_static/doctools.js"></script>
      <script type="text/javascript" src="_static/translations.js"></script>

  

  
  
    <script type="text/javascript" src="_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
   

</body>
</html>