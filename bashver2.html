

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>XXX 37.1. Bash, version 2 &mdash; Guia Avançada de Programació Bash 10 març de 2014 documentació</title>
  

  
  

  

  
  
    

  

  
  
    <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  

  

  
        <link rel="copyright" title="Copyright" href="copyright.html"/>
    <link rel="top" title="Guia Avançada de Programació Bash 10 març de 2014 documentació" href="index.html"/> 

  
  <script src="_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-nav-search">
        

        
          <a href="index.html" class="icon icon-home"> Guia Avançada de Programació Bash
        

        
        </a>

        
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Cercar..." />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

        
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
        
          
          
              <ul>
<li class="toctree-l1"><a class="reference internal" href="part1.html">Part 1. Introducció</a></li>
<li class="toctree-l1"><a class="reference internal" href="part2.html">Part 2. Conceptes bàsics</a></li>
<li class="toctree-l1"><a class="reference internal" href="part3.html">XXX Part 3. Beyond the Basics</a></li>
<li class="toctree-l1"><a class="reference internal" href="part4.html">XXX Part 4. Commands</a></li>
<li class="toctree-l1"><a class="reference internal" href="part5.html">XXX Part 5. Advanced Topics</a></li>
<li class="toctree-l1"><a class="reference internal" href="endnotes.html">Notes finals</a></li>
<li class="toctree-l1"><a class="reference internal" href="biblio.html">XXX  Bibliografia</a></li>
</ul>

          
        
      </div>
      &nbsp;
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="index.html">Guia Avançada de Programació Bash</a>
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="index.html">Inici</a> &raquo;</li>
      
    <li>XXX  37.1. Bash, version 2</li>
      <li class="wy-breadcrumbs-aside">
        
          
        
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document">
            
  <div class="section" id="xxx-37-1-bash-version-2">
<h1>XXX  37.1. Bash, version 2<a class="headerlink" href="#xxx-37-1-bash-version-2" title="Link permanent a aquest títol">¶</a></h1>
<p>The current version of <em>Bash</em> , the one you have running on your
machine, is most likely version 2.xx.yy, 3.xx.yy, or 4.xx.yy.</p>
<div class="highlight-sh"><div class="highlight"><pre>bash<span class="nv">$ </span><span class="nb">echo</span> <span class="nv">$BASH_VERSION</span>
3.2.25<span class="o">(</span>1<span class="o">)</span>-release
</pre></div>
</div>
<p>The version 2 update of the classic Bash scripting language added array
variables, string and parameter expansion, and a better method of
indirect variable references, among other features.</p>
<div class="section" id="exemple-1-string-expansion">
<h2>Exemple 1. String expansion<a class="headerlink" href="#exemple-1-string-expansion" title="Link permanent a aquest títol">¶</a></h2>
<div class="highlight-bash"><div class="highlight"><pre><span class="c">#!/bin/bash</span>

<span class="c"># XXX Demostració d&#39;expansió de cadenes de text</span>
<span class="c"># Introduced with version 2 of Bash.</span>

<span class="c">#  Strings of the form $&#39;xxx&#39;</span>
<span class="c">#+ have the standard escaped characters interpreted.</span>

<span class="nb">echo</span> <span class="s1">$&#39;Ringing bell 3 times \a \a \a&#39;</span>
<span class="c"># May only ring once with certain terminals.</span>
<span class="c"># Or ...</span>
<span class="c"># May not ring at all, depending on terminal settings.</span>
<span class="nb">echo</span> <span class="s1">$&#39;Three form feeds \f \f \f&#39;</span>
<span class="nb">echo</span> <span class="s1">$&#39;10 newlines \n\n\n\n\n\n\n\n\n\n&#39;</span>
<span class="nb">echo</span> <span class="s1">$&#39;\102\141\163\150&#39;</span>
<span class="c">#   B   a   s   h</span>
<span class="c"># Octal equivalent of characters.</span>

<span class="nb">exit</span>
</pre></div>
</div>
</div>
<div class="section" id="exemple-2-indirect-variable-references-the-new-way">
<h2>Exemple 2. Indirect variable references - the new way<a class="headerlink" href="#exemple-2-indirect-variable-references-the-new-way" title="Link permanent a aquest títol">¶</a></h2>
<div class="highlight-sh"><div class="highlight"><pre><span class="c">#!/bin/bash</span>

<span class="c"># Indirect variable referencing.</span>
<span class="c"># This has a few of the attributes of references in C++.</span>


<span class="nv">a</span><span class="o">=</span>letter_of_alphabet
<span class="nv">letter_of_alphabet</span><span class="o">=</span>z

<span class="nb">echo</span> <span class="s2">&quot;a = </span><span class="nv">$a</span><span class="s2">&quot;</span>           <span class="c"># Direct reference.</span>

<span class="nb">echo</span> <span class="s2">&quot;Now a = </span><span class="si">${</span><span class="p">!a</span><span class="si">}</span><span class="s2">&quot;</span>    <span class="c"># Indirect reference.</span>
<span class="c">#  The ${!variable} notation is more intuitive than the old</span>
<span class="c">#+ eval var1=\$$var2</span>

<span class="nb">echo</span>

<span class="nv">t</span><span class="o">=</span>table_cell_3
<span class="nv">table_cell_3</span><span class="o">=</span>24
<span class="nb">echo</span> <span class="s2">&quot;t = </span><span class="si">${</span><span class="p">!t</span><span class="si">}</span><span class="s2">&quot;</span>                      <span class="c"># t = 24</span>
<span class="nv">table_cell_3</span><span class="o">=</span>387
<span class="nb">echo</span> <span class="s2">&quot;Value of t changed to </span><span class="si">${</span><span class="p">!t</span><span class="si">}</span><span class="s2">&quot;</span>    <span class="c"># 387</span>
<span class="c"># No &#39;eval&#39; necessary.</span>

<span class="c">#  This is useful for referencing members of an array or table,</span>
<span class="c">#+ or for simulating a multi-dimensional array.</span>
<span class="c">#  An indexing option (analogous to pointer arithmetic)</span>
<span class="c">#+ would have been nice. Sigh.</span>

<span class="nb">exit </span>0

<span class="c"># See also, ind-ref.sh example.</span>
</pre></div>
</div>
</div>
<div class="section" id="exemple-3-simple-database-application-using-indirect-variable-referencing">
<h2>Exemple 3. Simple database application, using indirect variable referencing<a class="headerlink" href="#exemple-3-simple-database-application-using-indirect-variable-referencing" title="Link permanent a aquest títol">¶</a></h2>
<div class="highlight-sh"><div class="highlight"><pre><span class="c">#!/bin/bash</span>
<span class="c"># resistor-inventory.sh</span>
<span class="c"># Simple database / table-lookup application.</span>

<span class="c"># ============================================================== #</span>
<span class="c"># Data</span>

<span class="nv">B1723_value</span><span class="o">=</span><span class="m">470</span>                                   <span class="c"># Ohms</span>
<span class="nv">B1723_powerdissip</span><span class="o">=</span>.25                             <span class="c"># Watts</span>
<span class="nv">B1723_colorcode</span><span class="o">=</span><span class="s2">&quot;yellow-violet-brown&quot;</span>             <span class="c"># Color bands</span>
<span class="nv">B1723_loc</span><span class="o">=</span><span class="m">173</span>                                     <span class="c"># Where they are</span>
<span class="nv">B1723_inventory</span><span class="o">=</span><span class="m">78</span>                                <span class="c"># How many</span>

<span class="nv">B1724_value</span><span class="o">=</span>1000
<span class="nv">B1724_powerdissip</span><span class="o">=</span>.25
<span class="nv">B1724_colorcode</span><span class="o">=</span><span class="s2">&quot;brown-black-red&quot;</span>
<span class="nv">B1724_loc</span><span class="o">=</span>24N
<span class="nv">B1724_inventory</span><span class="o">=</span>243

<span class="nv">B1725_value</span><span class="o">=</span>10000
<span class="nv">B1725_powerdissip</span><span class="o">=</span>.125
<span class="nv">B1725_colorcode</span><span class="o">=</span><span class="s2">&quot;brown-black-orange&quot;</span>
<span class="nv">B1725_loc</span><span class="o">=</span>24N
<span class="nv">B1725_inventory</span><span class="o">=</span>89

<span class="c"># ============================================================== #</span>


<span class="nb">echo</span>

<span class="nv">PS3</span><span class="o">=</span><span class="s1">&#39;Enter catalog number: &#39;</span>

<span class="nb">echo</span>

<span class="k">select</span> catalog_number in <span class="s2">&quot;B1723&quot;</span> <span class="s2">&quot;B1724&quot;</span> <span class="s2">&quot;B1725&quot;</span>
<span class="k">do</span>
  <span class="nv">Inv</span><span class="o">=</span><span class="si">${</span><span class="nv">catalog_number</span><span class="si">}</span>_inventory
  <span class="nv">Val</span><span class="o">=</span><span class="si">${</span><span class="nv">catalog_number</span><span class="si">}</span>_value
  <span class="nv">Pdissip</span><span class="o">=</span><span class="si">${</span><span class="nv">catalog_number</span><span class="si">}</span>_powerdissip
  <span class="nv">Loc</span><span class="o">=</span><span class="si">${</span><span class="nv">catalog_number</span><span class="si">}</span>_loc
  <span class="nv">Ccode</span><span class="o">=</span><span class="si">${</span><span class="nv">catalog_number</span><span class="si">}</span>_colorcode

  <span class="nb">echo</span>
<span class="nb">  echo</span> <span class="s2">&quot;Catalog number </span><span class="nv">$catalog_number</span><span class="s2">:&quot;</span>
  <span class="c"># Now, retrieve value, using indirect referencing.</span>
  <span class="nb">echo</span> <span class="s2">&quot;There are </span><span class="si">${</span><span class="p">!Inv</span><span class="si">}</span><span class="s2"> of  [</span><span class="si">${</span><span class="p">!Val</span><span class="si">}</span><span class="s2"> ohm / </span><span class="si">${</span><span class="p">!Pdissip</span><span class="si">}</span><span class="s2"> watt]\</span>
<span class="s2">  resistors in stock.&quot;</span>  <span class="c">#        ^             ^</span>
  <span class="c"># As of Bash 4.2, you can replace &quot;ohm&quot; with \u2126 (using echo -e).</span>
  <span class="nb">echo</span> <span class="s2">&quot;These are located in bin # </span><span class="si">${</span><span class="p">!Loc</span><span class="si">}</span><span class="s2">.&quot;</span>
  <span class="nb">echo</span> <span class="s2">&quot;Their color code is \&quot;</span><span class="si">${</span><span class="p">!Ccode</span><span class="si">}</span><span class="s2">\&quot;.&quot;</span>

  <span class="nb">break</span>
<span class="k">done</span>

<span class="nb">echo</span><span class="p">;</span> <span class="nb">echo</span>

<span class="c"># Exercises:</span>
<span class="c"># ---------</span>
<span class="c"># 1) Rewrite this script to read its data from an external file.</span>
<span class="c"># 2) Rewrite this script to use arrays,</span>
<span class="c">#+   rather than indirect variable referencing.</span>
<span class="c">#    Which method is more straightforward and intuitive?</span>
<span class="c">#    Which method is easier to code?</span>


<span class="c"># Notes:</span>
<span class="c"># -----</span>
<span class="c">#  Shell scripts are inappropriate for anything except the most simple</span>
<span class="c">#+ database applications, and even then it involves workarounds and kludges.</span>
<span class="c">#  Much better is to use a language with native support for data structures,</span>
<span class="c">#+ such as C++ or Java (or even Perl).</span>

<span class="nb">exit </span>0
</pre></div>
</div>
</div>
<div class="section" id="exemple-4-using-arrays-and-other-miscellaneous-trickery-to-deal-four-random-hands-from-a-deck-of-cards">
<span id="basver2-exemple-cads"></span><h2>Exemple 4. Using arrays and other miscellaneous trickery to deal four random hands from a deck of cards<a class="headerlink" href="#exemple-4-using-arrays-and-other-miscellaneous-trickery-to-deal-four-random-hands-from-a-deck-of-cards" title="Link permanent a aquest títol">¶</a></h2>
<div class="highlight-sh"><div class="highlight"><pre><span class="c">#!/bin/bash</span>
<span class="c"># cards.sh</span>

<span class="c"># Deals four random hands from a deck of cards.</span>

<span class="nv">UNPICKED</span><span class="o">=</span>0
<span class="nv">PICKED</span><span class="o">=</span>1

<span class="nv">DUPE_CARD</span><span class="o">=</span>99

<span class="nv">LOWER_LIMIT</span><span class="o">=</span>0
<span class="nv">UPPER_LIMIT</span><span class="o">=</span>51
<span class="nv">CARDS_IN_SUIT</span><span class="o">=</span>13
<span class="nv">CARDS</span><span class="o">=</span>52

<span class="nb">declare</span> -a Deck
<span class="nb">declare</span> -a Suits
<span class="nb">declare</span> -a Cards
<span class="c">#  It would have been easier to implement and more intuitive</span>
<span class="c">#+ with a single, 3-dimensional array.</span>
<span class="c">#  Perhaps a future version of Bash will support multidimensional arrays.</span>


initialize_Deck <span class="o">()</span>
<span class="o">{</span>
<span class="nv">i</span><span class="o">=</span><span class="nv">$LOWER_LIMIT</span>
<span class="k">until</span> <span class="o">[</span> <span class="s2">&quot;</span><span class="nv">$i</span><span class="s2">&quot;</span> -gt <span class="nv">$UPPER_LIMIT</span> <span class="o">]</span>
<span class="k">do</span>
  Deck<span class="o">[</span>i<span class="o">]=</span><span class="nv">$UNPICKED</span>   <span class="c"># Set each card of &quot;Deck&quot; as unpicked.</span>
  <span class="nb">let</span> <span class="s2">&quot;i += 1&quot;</span>
<span class="k">done</span>
<span class="nb">echo</span>
<span class="o">}</span>

initialize_Suits <span class="o">()</span>
<span class="o">{</span>
Suits<span class="o">[</span>0<span class="o">]=</span>C <span class="c">#Clubs</span>
Suits<span class="o">[</span>1<span class="o">]=</span>D <span class="c">#Diamonds</span>
Suits<span class="o">[</span>2<span class="o">]=</span>H <span class="c">#Hearts</span>
Suits<span class="o">[</span>3<span class="o">]=</span>S <span class="c">#Spades</span>
<span class="o">}</span>

initialize_Cards <span class="o">()</span>
<span class="o">{</span>
<span class="nv">Cards</span><span class="o">=(</span><span class="m">2</span> <span class="m">3</span> <span class="m">4</span> <span class="m">5</span> <span class="m">6</span> <span class="m">7</span> <span class="m">8</span> <span class="m">9</span> <span class="m">10</span> J Q K A<span class="o">)</span>
<span class="c"># Alternate method of initializing an array.</span>
<span class="o">}</span>

pick_a_card <span class="o">()</span>
<span class="o">{</span>
<span class="nv">card_number</span><span class="o">=</span><span class="nv">$RANDOM</span>
<span class="nb">let</span> <span class="s2">&quot;card_number %= </span><span class="nv">$CARDS</span><span class="s2">&quot;</span> <span class="c"># Restrict range to 0 - 51, i.e., 52 cards.</span>
<span class="k">if</span> <span class="o">[</span> <span class="s2">&quot;</span><span class="si">${</span><span class="nv">Deck</span><span class="p">[card_number]</span><span class="si">}</span><span class="s2">&quot;</span> -eq <span class="nv">$UNPICKED</span> <span class="o">]</span>
<span class="k">then</span>
  Deck<span class="o">[</span>card_number<span class="o">]=</span><span class="nv">$PICKED</span>
  <span class="k">return</span> <span class="nv">$card_number</span>
<span class="k">else</span>
  <span class="k">return</span> <span class="nv">$DUPE_CARD</span>
<span class="k">fi</span>
<span class="o">}</span>

parse_card <span class="o">()</span>
<span class="o">{</span>
<span class="nv">number</span><span class="o">=</span><span class="nv">$1</span>
<span class="nb">let</span> <span class="s2">&quot;suit_number = number / CARDS_IN_SUIT&quot;</span>
<span class="nv">suit</span><span class="o">=</span><span class="si">${</span><span class="nv">Suits</span><span class="p">[suit_number]</span><span class="si">}</span>
<span class="nb">echo</span> -n <span class="s2">&quot;</span><span class="nv">$suit</span><span class="s2">-&quot;</span>
<span class="nb">let</span> <span class="s2">&quot;card_no = number % CARDS_IN_SUIT&quot;</span>
<span class="nv">Card</span><span class="o">=</span><span class="si">${</span><span class="nv">Cards</span><span class="p">[card_no]</span><span class="si">}</span>
<span class="nb">printf</span> %-4s <span class="nv">$Card</span>
<span class="c"># Print cards in neat columns.</span>
<span class="o">}</span>

seed_random <span class="o">()</span>  <span class="c"># Seed random number generator.</span>
<span class="o">{</span>               <span class="c"># What happens if you don&#39;t do this?</span>
<span class="nv">seed</span><span class="o">=</span><span class="sb">`</span><span class="nb">eval </span>date +%s<span class="sb">`</span>
<span class="nb">let</span> <span class="s2">&quot;seed %= 32766&quot;</span>
<span class="nv">RANDOM</span><span class="o">=</span><span class="nv">$seed</span>
<span class="o">}</span> <span class="c"># Consider other methods of seeding the random number generator.</span>

deal_cards <span class="o">()</span>
<span class="o">{</span>
<span class="nb">echo</span>

<span class="nv">cards_picked</span><span class="o">=</span>0
<span class="k">while</span> <span class="o">[</span> <span class="s2">&quot;</span><span class="nv">$cards_picked</span><span class="s2">&quot;</span> -le <span class="nv">$UPPER_LIMIT</span> <span class="o">]</span>
<span class="k">do</span>
  pick_a_card
  <span class="nv">t</span><span class="o">=</span><span class="nv">$?</span>

  <span class="k">if</span> <span class="o">[</span> <span class="s2">&quot;</span><span class="nv">$t</span><span class="s2">&quot;</span> -ne <span class="nv">$DUPE_CARD</span> <span class="o">]</span>
  <span class="k">then</span>
    parse_card <span class="nv">$t</span>

    <span class="nv">u</span><span class="o">=</span><span class="nv">$cards_picked</span>+1
    <span class="c"># Change back to 1-based indexing, temporarily. Why?</span>
    <span class="nb">let</span> <span class="s2">&quot;u %= </span><span class="nv">$CARDS_IN_SUIT</span><span class="s2">&quot;</span>
    <span class="k">if</span> <span class="o">[</span> <span class="s2">&quot;</span><span class="nv">$u</span><span class="s2">&quot;</span> -eq <span class="m">0</span> <span class="o">]</span>   <span class="c"># Nested if/then condition test.</span>
    <span class="k">then</span>
     <span class="nb">echo</span>
<span class="nb">     echo</span>
<span class="nb">    </span><span class="k">fi</span>                  <span class="c"># Each hand set apart with a blank line.</span>

    <span class="nb">let</span> <span class="s2">&quot;cards_picked += 1&quot;</span>
  <span class="k">fi</span>
<span class="k">done</span>

<span class="nb">echo</span>

<span class="k">return</span> 0
<span class="o">}</span>


<span class="c"># Structured programming:</span>
<span class="c"># Entire program logic modularized in functions.</span>

<span class="c">#===============</span>
seed_random
initialize_Deck
initialize_Suits
initialize_Cards
deal_cards
<span class="c">#===============</span>

<span class="nb">exit</span>



<span class="c"># Exercise 1:</span>
<span class="c"># Add comments to thoroughly document this script.</span>

<span class="c"># Exercise 2:</span>
<span class="c"># Add a routine (function) to print out each hand sorted in suits.</span>
<span class="c"># You may add other bells and whistles if you like.</span>

<span class="c"># Exercise 3:</span>
<span class="c"># Simplify and streamline the logic of the script.</span>
</pre></div>
</div>
</div>
</div>


          </div>
          <footer>
  <hr/>

  

  <div role="contentinfo">
    <p>
    </p>
  </div>
      Pàgina generada amb <a href="http://sphinx-doc.org/">Sphinx</a> amb una lleugera
                                     variació del tema<a
                                     href="https://github.com/snide/sphinx_rtd_theme">
                                         sphinx-rtd-theme </a>.

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'./',
            VERSION:'10 març de 2014',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true
        };
    </script>
      <script type="text/javascript" src="_static/jquery.js"></script>
      <script type="text/javascript" src="_static/underscore.js"></script>
      <script type="text/javascript" src="_static/doctools.js"></script>
      <script type="text/javascript" src="_static/translations.js"></script>

  

  
  
    <script type="text/javascript" src="_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
   

</body>
</html>