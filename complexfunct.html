

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>XXX 24.1. Complex Functions and Function Complexities &mdash; Guia Avançada de Programació Bash 10 març de 2014 documentació</title>
  

  
  

  

  
  
    

  

  
  
    <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  

  

  
        <link rel="copyright" title="Copyright" href="copyright.html"/>
    <link rel="top" title="Guia Avançada de Programació Bash 10 març de 2014 documentació" href="index.html"/> 

  
  <script src="_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-nav-search">
        

        
          <a href="index.html" class="icon icon-home"> Guia Avançada de Programació Bash
        

        
        </a>

        
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Cercar..." />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

        
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
        
          
          
              <ul>
<li class="toctree-l1"><a class="reference internal" href="part1.html">Part 1. Introducció</a></li>
<li class="toctree-l1"><a class="reference internal" href="part2.html">Part 2. Conceptes bàsics</a></li>
<li class="toctree-l1"><a class="reference internal" href="part3.html">XXX Part 3. Beyond the Basics</a></li>
<li class="toctree-l1"><a class="reference internal" href="part4.html">XXX Part 4. Commands</a></li>
<li class="toctree-l1"><a class="reference internal" href="part5.html">XXX Part 5. Advanced Topics</a></li>
<li class="toctree-l1"><a class="reference internal" href="endnotes.html">Notes finals</a></li>
<li class="toctree-l1"><a class="reference internal" href="biblio.html">XXX  Bibliografia</a></li>
</ul>

          
        
      </div>
      &nbsp;
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="index.html">Guia Avançada de Programació Bash</a>
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="index.html">Inici</a> &raquo;</li>
      
    <li>XXX  24.1. Complex Functions and Function Complexities</li>
      <li class="wy-breadcrumbs-aside">
        
          
        
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document">
            
  <div class="section" id="xxx-24-1-complex-functions-and-function-complexities">
<h1>XXX  24.1. Complex Functions and Function Complexities<a class="headerlink" href="#xxx-24-1-complex-functions-and-function-complexities" title="Link permanent a aquest títol">¶</a></h1>
<p>Functions may process arguments passed to them and return an <a class="reference external" href="exit-status.html#EXITSTATUSREF">exit
status</a> to the script for further
processing.</p>
<div class="highlight-sh"><div class="highlight"><pre>function_name <span class="nv">$arg1</span> <span class="nv">$arg2</span>
</pre></div>
</div>
<p>The function refers to the passed arguments by position (as if they were
<a class="reference external" href="internalvariables.html#POSPARAMREF">positional parameters</a> ), that
is, ``      $1     `` , ``      $2     `` , and so forth.</p>
<div class="section" id="exemple-2-function-taking-parameters">
<h2>Exemple 2. Function Taking Parameters<a class="headerlink" href="#exemple-2-function-taking-parameters" title="Link permanent a aquest títol">¶</a></h2>
<div class="highlight-sh"><div class="highlight"><pre><span class="c">#!/bin/bash</span>
<span class="c"># Functions and parameters</span>

<span class="nv">DEFAULT</span><span class="o">=</span>default                             <span class="c"># Default param value.</span>

func2 <span class="o">()</span> <span class="o">{</span>
   <span class="k">if</span> <span class="o">[</span> -z <span class="s2">&quot;</span><span class="nv">$1</span><span class="s2">&quot;</span> <span class="o">]</span>                           <span class="c"># Is parameter #1 zero length?</span>
   <span class="k">then</span>
     <span class="nb">echo</span> <span class="s2">&quot;-Parameter #1 is zero length.-&quot;</span>  <span class="c"># Or no parameter passed.</span>
   <span class="k">else</span>
     <span class="nb">echo</span> <span class="s2">&quot;-Parameter #1 is \&quot;</span><span class="nv">$1</span><span class="s2">\&quot;.-&quot;</span>
   <span class="k">fi</span>

   <span class="nv">variable</span><span class="o">=</span><span class="si">${</span><span class="nv">1</span><span class="p">-</span><span class="nv">$DEFAULT</span><span class="si">}</span>                   <span class="c">#  What does</span>
   <span class="nb">echo</span> <span class="s2">&quot;variable = </span><span class="nv">$variable</span><span class="s2">&quot;</span>              <span class="c">#+ parameter substitution show?</span>
                                            <span class="c">#  ---------------------------</span>
                                            <span class="c">#  It distinguishes between</span>
                                            <span class="c">#+ no param and a null param.</span>

   <span class="k">if</span> <span class="o">[</span> <span class="s2">&quot;</span><span class="nv">$2</span><span class="s2">&quot;</span> <span class="o">]</span>
   <span class="k">then</span>
     <span class="nb">echo</span> <span class="s2">&quot;-Parameter #2 is \&quot;</span><span class="nv">$2</span><span class="s2">\&quot;.-&quot;</span>
   <span class="k">fi</span>

   <span class="k">return</span> 0
<span class="o">}</span>

<span class="nb">echo</span>

<span class="nb">echo</span> <span class="s2">&quot;Nothing passed.&quot;</span>
func2                          <span class="c"># Called with no params</span>
<span class="nb">echo</span>


<span class="nb">echo</span> <span class="s2">&quot;Zero-length parameter passed.&quot;</span>
func2 <span class="s2">&quot;&quot;</span>                       <span class="c"># Called with zero-length param</span>
<span class="nb">echo</span>

<span class="nb">echo</span> <span class="s2">&quot;Null parameter passed.&quot;</span>
func2 <span class="s2">&quot;</span><span class="nv">$uninitialized_param</span><span class="s2">&quot;</span>   <span class="c"># Called with uninitialized param</span>
<span class="nb">echo</span>

<span class="nb">echo</span> <span class="s2">&quot;One parameter passed.&quot;</span>
func2 first           <span class="c"># Called with one param</span>
<span class="nb">echo</span>

<span class="nb">echo</span> <span class="s2">&quot;Two parameters passed.&quot;</span>
func2 first second    <span class="c"># Called with two params</span>
<span class="nb">echo</span>

<span class="nb">echo</span> <span class="s2">&quot;\&quot;\&quot; \&quot;second\&quot; passed.&quot;</span>
func2 <span class="s2">&quot;&quot;</span> second       <span class="c"># Called with zero-length first parameter</span>
<span class="nb">echo</span>                  <span class="c"># and ASCII string as a second one.</span>

<span class="nb">exit </span>0
</pre></div>
</div>
<p><a href="#id1"><span class="problematic" id="id2">|</span></a>Important</p>
<p>The <a class="reference external" href="othertypesv.html#SHIFTREF">shift</a> command works on arguments
passed to functions (see <a class="reference external" href="assortedtips.html#MULTIPLICATION">Example
36-18</a> ).</p>
<p>But, what about command-line arguments passed to the script? Does a
function see them? Well, let&#8217;s clear up the confusion.</p>
</div>
<div class="section" id="exemple-3-functions-and-command-line-args-passed-to-the-script">
<h2>Exemple 3. Functions and command-line args passed to the script<a class="headerlink" href="#exemple-3-functions-and-command-line-args-passed-to-the-script" title="Link permanent a aquest títol">¶</a></h2>
<div class="highlight-sh"><div class="highlight"><pre><span class="c">#!/bin/bash</span>
<span class="c"># func-cmdlinearg.sh</span>
<span class="c">#  Call this script with a command-line argument,</span>
<span class="c">#+ something like $0 arg1.</span>


func <span class="o">()</span>

<span class="o">{</span>
<span class="nb">echo</span> <span class="s2">&quot;</span><span class="nv">$1</span><span class="s2">&quot;</span>   <span class="c"># Echoes first arg passed to the function.</span>
<span class="o">}</span>           <span class="c"># Does a command-line arg qualify?</span>

<span class="nb">echo</span> <span class="s2">&quot;First call to function: no arg passed.&quot;</span>
<span class="nb">echo</span> <span class="s2">&quot;See if command-line arg is seen.&quot;</span>
func
<span class="c"># No! Command-line arg not seen.</span>

<span class="nb">echo</span> <span class="s2">&quot;============================================================&quot;</span>
<span class="nb">echo</span>
<span class="nb">echo</span> <span class="s2">&quot;Second call to function: command-line arg passed explicitly.&quot;</span>
func <span class="nv">$1</span>
<span class="c"># Now it&#39;s seen!</span>

<span class="nb">exit </span>0
</pre></div>
</div>
<p>In contrast to certain other programming languages, shell scripts
normally pass only value parameters to functions. Variable names (which
are actually <em>pointers</em> ), if passed as parameters to functions, will be
treated as string literals. <em>Functions interpret their arguments
literally.</em></p>
<p><a class="reference external" href="ivr.html#IVRREF">Indirect variable references</a> (see <a class="reference external" href="bashver2.html#EX78">Example
37-2</a> ) provide a clumsy sort of mechanism for
passing variable pointers to functions.</p>
</div>
<div class="section" id="exemple-4-passing-an-indirect-reference-to-a-function">
<h2>Exemple 4. Passing an indirect reference to a function<a class="headerlink" href="#exemple-4-passing-an-indirect-reference-to-a-function" title="Link permanent a aquest títol">¶</a></h2>
<div class="highlight-sh"><div class="highlight"><pre><span class="c">#!/bin/bash</span>
<span class="c"># ind-func.sh: Passing an indirect reference to a function.</span>

echo_var <span class="o">()</span>
<span class="o">{</span>
<span class="nb">echo</span> <span class="s2">&quot;</span><span class="nv">$1</span><span class="s2">&quot;</span>
<span class="o">}</span>

<span class="nv">message</span><span class="o">=</span>Hello
<span class="nv">Hello</span><span class="o">=</span>Goodbye

echo_var <span class="s2">&quot;</span><span class="nv">$message</span><span class="s2">&quot;</span>        <span class="c"># Hello</span>
<span class="c"># Now, let&#39;s pass an indirect reference to the function.</span>
echo_var <span class="s2">&quot;</span><span class="si">${</span><span class="p">!message</span><span class="si">}</span><span class="s2">&quot;</span>     <span class="c"># Goodbye</span>

<span class="nb">echo</span> <span class="s2">&quot;-------------&quot;</span>

<span class="c"># What happens if we change the contents of &quot;hello&quot; variable?</span>
<span class="nv">Hello</span><span class="o">=</span><span class="s2">&quot;Hello, again!&quot;</span>
echo_var <span class="s2">&quot;</span><span class="nv">$message</span><span class="s2">&quot;</span>        <span class="c"># Hello</span>
echo_var <span class="s2">&quot;</span><span class="si">${</span><span class="p">!message</span><span class="si">}</span><span class="s2">&quot;</span>     <span class="c"># Hello, again!</span>

<span class="nb">exit </span>0
</pre></div>
</div>
<p>The next logical question is whether parameters can be dereferenced
<em>after</em> being passed to a function.</p>
</div>
<div class="section" id="exemple-5-dereferencing-a-parameter-passed-to-a-function">
<h2>Exemple 5. Dereferencing a parameter passed to a function<a class="headerlink" href="#exemple-5-dereferencing-a-parameter-passed-to-a-function" title="Link permanent a aquest títol">¶</a></h2>
<div class="highlight-sh"><div class="highlight"><pre><span class="c">#!/bin/bash</span>
<span class="c"># dereference.sh</span>
<span class="c"># Dereferencing parameter passed to a function.</span>
<span class="c"># Script by Bruce W. Clare.</span>

dereference <span class="o">()</span>
<span class="o">{</span>
     <span class="nv">y</span><span class="o">=</span><span class="se">\$</span><span class="s2">&quot;</span><span class="nv">$1</span><span class="s2">&quot;</span>   <span class="c"># Name of variable (not value!).</span>
     <span class="nb">echo</span> <span class="nv">$y</span>    <span class="c"># $Junk</span>

     <span class="nv">x</span><span class="o">=</span><span class="sb">`</span><span class="nb">eval</span> <span class="s2">&quot;expr \&quot;</span><span class="nv">$y</span><span class="s2">\&quot; &quot;</span><span class="sb">`</span>
     <span class="nb">echo</span> <span class="nv">$1</span><span class="o">=</span><span class="nv">$x</span>
     <span class="nb">eval</span> <span class="s2">&quot;</span><span class="nv">$1</span><span class="s2">=\&quot;Some Different Text \&quot;&quot;</span>  <span class="c"># Assign new value.</span>
<span class="o">}</span>

<span class="nv">Junk</span><span class="o">=</span><span class="s2">&quot;Some Text&quot;</span>
<span class="nb">echo</span> <span class="nv">$Junk</span> <span class="s2">&quot;before&quot;</span>    <span class="c"># Some Text before</span>

dereference Junk
<span class="nb">echo</span> <span class="nv">$Junk</span> <span class="s2">&quot;after&quot;</span>     <span class="c"># Some Different Text after</span>

<span class="nb">exit </span>0
</pre></div>
</div>
</div>
<div class="section" id="exemple-6-again-dereferencing-a-parameter-passed-to-a-function">
<h2>Exemple 6. Again, dereferencing a parameter passed to a function<a class="headerlink" href="#exemple-6-again-dereferencing-a-parameter-passed-to-a-function" title="Link permanent a aquest títol">¶</a></h2>
<div class="highlight-sh"><div class="highlight"><pre><span class="c">#!/bin/bash</span>
<span class="c"># ref-params.sh: Dereferencing a parameter passed to a function.</span>
<span class="c">#                (Complex Example)</span>

<span class="nv">ITERATIONS</span><span class="o">=</span><span class="m">3</span>  <span class="c"># How many times to get input.</span>
<span class="nv">icount</span><span class="o">=</span>1

my_read <span class="o">()</span> <span class="o">{</span>
  <span class="c">#  Called with my_read varname,</span>
  <span class="c">#+ outputs the previous value between brackets as the default value,</span>
  <span class="c">#+ then asks for a new value.</span>

  <span class="nb">local </span>local_var

  <span class="nb">echo</span> -n <span class="s2">&quot;Enter a value &quot;</span>
  <span class="nb">eval</span> <span class="s1">&#39;echo -n &quot;[$&#39;</span><span class="nv">$1</span><span class="s1">&#39;] &quot;&#39;</span>  <span class="c">#  Previous value.</span>
<span class="c"># eval echo -n &quot;[\$$1] &quot;     #  Easier to understand,</span>
                             <span class="c">#+ but loses trailing space in user prompt.</span>
  <span class="nb">read </span>local_var
  <span class="o">[</span> -n <span class="s2">&quot;</span><span class="nv">$local_var</span><span class="s2">&quot;</span> <span class="o">]</span> <span class="o">&amp;&amp;</span> <span class="nb">eval</span> <span class="nv">$1</span><span class="o">=</span><span class="se">\$</span>local_var

  <span class="c"># &quot;And-list&quot;: if &quot;local_var&quot; then set &quot;$1&quot; to its value.</span>
<span class="o">}</span>

<span class="nb">echo</span>

<span class="k">while</span> <span class="o">[</span> <span class="s2">&quot;</span><span class="nv">$icount</span><span class="s2">&quot;</span> -le <span class="s2">&quot;</span><span class="nv">$ITERATIONS</span><span class="s2">&quot;</span> <span class="o">]</span>
<span class="k">do</span>
  my_read var
  <span class="nb">echo</span> <span class="s2">&quot;Entry #</span><span class="nv">$icount</span><span class="s2"> = </span><span class="nv">$var</span><span class="s2">&quot;</span>
  <span class="nb">let</span> <span class="s2">&quot;icount += 1&quot;</span>
  <span class="nb">echo</span>
<span class="k">done</span>


<span class="c"># Thanks to Stephane Chazelas for providing this instructive example.</span>

<span class="nb">exit </span>0
</pre></div>
</div>
<p>** Exit and Return**</p>
<blockquote>
<div><dl class="docutils">
<dt><strong>exit status</strong></dt>
<dd>Functions return a value, called an <em>exit status</em> . This is
analogous to the <a class="reference external" href="exit-status.html#EXITSTATUSREF">exit status</a>
returned by a command. The exit status may be explicitly specified
by a <strong>return</strong> statement, otherwise it is the exit status of the
last command in the function ( 0 if successful, and a non-zero error
code if not). This <a class="reference external" href="exit-status.html#EXITSTATUSREF">exit status</a>
may be used in the script by referencing it as
<a class="reference external" href="internalvariables.html#XSTATVARREF">$?</a> . This mechanism
effectively permits script functions to have a &#8220;return value&#8221;
similar to C functions.</dd>
</dl>
<p><strong>return</strong></p>
<blockquote>
<div><dl class="docutils">
<dt>Terminates a function. A <strong>return</strong> command ` [1]</dt>
<dd>&lt;complexfunct.html#FTN.AEN18474&gt;`__ optionally takes an <em>integer</em></dd>
</dl>
<p>argument, which is returned to the calling script as the &#8220;exit
status&#8221; of the function, and this exit status is assigned to the
variable <a class="reference external" href="internalvariables.html#XSTATVARREF">$?</a> .</p>
</div></blockquote>
</div></blockquote>
</div>
<div class="section" id="exemple-7-maximum-of-two-numbers">
<h2>Exemple 7. Maximum of two numbers<a class="headerlink" href="#exemple-7-maximum-of-two-numbers" title="Link permanent a aquest títol">¶</a></h2>
<blockquote>
<div><div class="highlight-sh"><div class="highlight"><pre><span class="c">#!/bin/bash</span>
<span class="c"># max.sh: Maximum of two integers.</span>

<span class="nv">E_PARAM_ERR</span><span class="o">=</span><span class="m">250</span>    <span class="c"># If less than 2 params passed to function.</span>
<span class="nv">EQUAL</span><span class="o">=</span><span class="m">251</span>          <span class="c"># Return value if both params equal.</span>
<span class="c">#  Error values out of range of any</span>
<span class="c">#+ params that might be fed to the function.</span>

max2 <span class="o">()</span>             <span class="c"># Returns larger of two numbers.</span>
<span class="o">{</span>                   <span class="c"># Note: numbers compared must be less than 250.</span>
<span class="k">if</span> <span class="o">[</span> -z <span class="s2">&quot;</span><span class="nv">$2</span><span class="s2">&quot;</span> <span class="o">]</span>
<span class="k">then</span>
  <span class="k">return</span> <span class="nv">$E_PARAM_ERR</span>
<span class="k">fi</span>

<span class="k">if</span> <span class="o">[</span> <span class="s2">&quot;</span><span class="nv">$1</span><span class="s2">&quot;</span> -eq <span class="s2">&quot;</span><span class="nv">$2</span><span class="s2">&quot;</span> <span class="o">]</span>
<span class="k">then</span>
  <span class="k">return</span> <span class="nv">$EQUAL</span>
<span class="k">else</span>
  <span class="k">if</span> <span class="o">[</span> <span class="s2">&quot;</span><span class="nv">$1</span><span class="s2">&quot;</span> -gt <span class="s2">&quot;</span><span class="nv">$2</span><span class="s2">&quot;</span> <span class="o">]</span>
  <span class="k">then</span>
    <span class="k">return</span> <span class="nv">$1</span>
  <span class="k">else</span>
    <span class="k">return</span> <span class="nv">$2</span>
  <span class="k">fi</span>
<span class="k">fi</span>
<span class="o">}</span>

max2 <span class="m">33</span> 34
<span class="nv">return_val</span><span class="o">=</span><span class="nv">$?</span>

<span class="k">if</span> <span class="o">[</span> <span class="s2">&quot;</span><span class="nv">$return_val</span><span class="s2">&quot;</span> -eq <span class="nv">$E_PARAM_ERR</span> <span class="o">]</span>
<span class="k">then</span>
  <span class="nb">echo</span> <span class="s2">&quot;Need to pass two parameters to the function.&quot;</span>
<span class="k">elif</span> <span class="o">[</span> <span class="s2">&quot;</span><span class="nv">$return_val</span><span class="s2">&quot;</span> -eq <span class="nv">$EQUAL</span> <span class="o">]</span>
  <span class="k">then</span>
    <span class="nb">echo</span> <span class="s2">&quot;The two numbers are equal.&quot;</span>
<span class="k">else</span>
    <span class="nb">echo</span> <span class="s2">&quot;The larger of the two numbers is </span><span class="nv">$return_val</span><span class="s2">.&quot;</span>
<span class="k">fi</span>


<span class="nb">exit </span>0

<span class="c">#  Exercise (easy):</span>
<span class="c">#  ---------------</span>
<span class="c">#  Convert this to an interactive script,</span>
<span class="c">#+ that is, have the script ask for input (two numbers).</span>
</pre></div>
</div>
</div></blockquote>
<div class="admonition tip">
<p class="first admonition-title">Pista</p>
<p class="last">For a function to return a string or array, use a dedicated
variable.</p>
</div>
<hr class="docutils" />
<div class="highlight-sh"><div class="highlight"><pre>count_lines_in_etc_p
</pre></div>
</div>
<dl class="docutils">
<dt>asswd()</dt>
<dd><dl class="first last docutils">
<dt>{</dt>
<dd>[[ -r /etc/passwd</dd>
</dl>
</dd>
</dl>
<p>]] &amp;&amp; REPLY=$(echo $(wc
-l &lt; /etc/passwd))</p>
<blockquote>
<div>#  If /etc/passwd</div></blockquote>
<p>is readable, set REPLY t
o line count.</p>
<blockquote>
<div>#  Returns both a</div></blockquote>
<p>parameter value and stat
us information.</p>
<blockquote>
<div>#  The &#8216;echo&#8217; seem</div></blockquote>
<dl class="docutils">
<dt>s unnecessary, but . . .</dt>
<dd>#+ it removes exce</dd>
</dl>
<p>ss whitespace from the o
utput.</p>
<blockquote>
<div><p>}</p>
<p>if count_lines_in_et</p>
</div></blockquote>
<dl class="docutils">
<dt>c_passwd</dt>
<dd><dl class="first last docutils">
<dt>then</dt>
<dd>echo &#8220;There are $R</dd>
</dl>
</dd>
</dl>
<p>EPLY lines in /etc/passw
d.&#8221;</p>
<blockquote>
<div><blockquote>
<div><dl class="docutils">
<dt>else</dt>
<dd>echo &#8220;Cannot count</dd>
</dl>
</div></blockquote>
<dl class="docutils">
<dt>lines in /etc/passwd.&#8221;</dt>
<dd><p class="first">fi</p>
<p class="last"># Thanks, S.C.</p>
</dd>
</dl>
</div></blockquote>
<hr class="docutils" />
<blockquote>
<div><div class="highlight-sh"><div class="highlight"><pre>count_lines_in_etc_passwd<span class="o">()</span>
<span class="o">{</span>
  <span class="o">[[</span> -r /etc/passwd <span class="o">]]</span> <span class="o">&amp;&amp;</span> <span class="nv">REPLY</span><span class="o">=</span><span class="k">$(</span><span class="nb">echo</span> <span class="k">$(</span>wc -l &lt; /etc/passwd<span class="k">))</span>
  <span class="c">#  If /etc/passwd is readable, set REPLY to line count.</span>
  <span class="c">#  Returns both a parameter value and status information.</span>
  <span class="c">#  The &#39;echo&#39; seems unnecessary, but . . .</span>
  <span class="c">#+ it removes excess whitespace from the output.</span>
<span class="o">}</span>

<span class="k">if</span> count_lines_in_etc_passwd
<span class="k">then</span>
  <span class="nb">echo</span> <span class="s2">&quot;There are </span><span class="nv">$REPLY</span><span class="s2"> lines in /etc/passwd.&quot;</span>
<span class="k">else</span>
  <span class="nb">echo</span> <span class="s2">&quot;Cannot count lines in /etc/passwd.&quot;</span>
<span class="k">fi</span>

<span class="c"># Thanks, S.C.</span>
</pre></div>
</div>
<div class="highlight-sh"><div class="highlight"><pre>count_lines_in_etc_passwd<span class="o">()</span>
<span class="o">{</span>
  <span class="o">[[</span> -r /etc/passwd <span class="o">]]</span> <span class="o">&amp;&amp;</span> <span class="nv">REPLY</span><span class="o">=</span><span class="k">$(</span><span class="nb">echo</span> <span class="k">$(</span>wc -l &lt; /etc/passwd<span class="k">))</span>
  <span class="c">#  If /etc/passwd is readable, set REPLY to line count.</span>
  <span class="c">#  Returns both a parameter value and status information.</span>
  <span class="c">#  The &#39;echo&#39; seems unnecessary, but . . .</span>
  <span class="c">#+ it removes excess whitespace from the output.</span>
<span class="o">}</span>

<span class="k">if</span> count_lines_in_etc_passwd
<span class="k">then</span>
  <span class="nb">echo</span> <span class="s2">&quot;There are </span><span class="nv">$REPLY</span><span class="s2"> lines in /etc/passwd.&quot;</span>
<span class="k">else</span>
  <span class="nb">echo</span> <span class="s2">&quot;Cannot count lines in /etc/passwd.&quot;</span>
<span class="k">fi</span>

<span class="c"># Thanks, S.C.</span>
</pre></div>
</div>
</div></blockquote>
</div>
<div class="section" id="exemple-8-converting-numbers-to-roman-numerals">
<h2>Exemple 8. Converting numbers to Roman numerals<a class="headerlink" href="#exemple-8-converting-numbers-to-roman-numerals" title="Link permanent a aquest títol">¶</a></h2>
<blockquote>
<div><div class="highlight-sh"><div class="highlight"><pre><span class="c">#!/bin/bash</span>

<span class="c"># Arabic number to Roman numeral conversion</span>
<span class="c"># Range: 0 - 200</span>
<span class="c"># It&#39;s crude, but it works.</span>

<span class="c"># Extending the range and otherwise improving the script is left as an exercise.</span>

<span class="c"># Usage: roman number-to-convert</span>

<span class="nv">LIMIT</span><span class="o">=</span>200
<span class="nv">E_ARG_ERR</span><span class="o">=</span>65
<span class="nv">E_OUT_OF_RANGE</span><span class="o">=</span>66

<span class="k">if</span> <span class="o">[</span> -z <span class="s2">&quot;</span><span class="nv">$1</span><span class="s2">&quot;</span> <span class="o">]</span>
<span class="k">then</span>
  <span class="nb">echo</span> <span class="s2">&quot;Usage: `basename </span><span class="nv">$0</span><span class="s2">` number-to-convert&quot;</span>
  <span class="nb">exit</span> <span class="nv">$E_ARG_ERR</span>
<span class="k">fi</span>

<span class="nv">num</span><span class="o">=</span><span class="nv">$1</span>
<span class="k">if</span> <span class="o">[</span> <span class="s2">&quot;</span><span class="nv">$num</span><span class="s2">&quot;</span> -gt <span class="nv">$LIMIT</span> <span class="o">]</span>
<span class="k">then</span>
  <span class="nb">echo</span> <span class="s2">&quot;Out of range!&quot;</span>
  <span class="nb">exit</span> <span class="nv">$E_OUT_OF_RANGE</span>
<span class="k">fi</span>

to_roman <span class="o">()</span>   <span class="c"># Must declare function before first call to it.</span>
<span class="o">{</span>
<span class="nv">number</span><span class="o">=</span><span class="nv">$1</span>
<span class="nv">factor</span><span class="o">=</span><span class="nv">$2</span>
<span class="nv">rchar</span><span class="o">=</span><span class="nv">$3</span>
<span class="nb">let</span> <span class="s2">&quot;remainder = number - factor&quot;</span>
<span class="k">while</span> <span class="o">[</span> <span class="s2">&quot;</span><span class="nv">$remainder</span><span class="s2">&quot;</span> -ge <span class="m">0</span> <span class="o">]</span>
<span class="k">do</span>
  <span class="nb">echo</span> -n <span class="nv">$rchar</span>
  <span class="nb">let</span> <span class="s2">&quot;number -= factor&quot;</span>
  <span class="nb">let</span> <span class="s2">&quot;remainder = number - factor&quot;</span>
<span class="k">done</span>

<span class="k">return</span> <span class="nv">$number</span>
       <span class="c"># Exercises:</span>
       <span class="c"># ---------</span>
       <span class="c"># 1) Explain how this function works.</span>
       <span class="c">#    Hint: division by successive subtraction.</span>
       <span class="c"># 2) Extend to range of the function.</span>
       <span class="c">#    Hint: use &quot;echo&quot; and command-substitution capture.</span>
<span class="o">}</span>


to_roman <span class="nv">$num</span> <span class="m">100</span> C
<span class="nv">num</span><span class="o">=</span><span class="nv">$?</span>
to_roman <span class="nv">$num</span> <span class="m">90</span> LXXXX
<span class="nv">num</span><span class="o">=</span><span class="nv">$?</span>
to_roman <span class="nv">$num</span> <span class="m">50</span> L
<span class="nv">num</span><span class="o">=</span><span class="nv">$?</span>
to_roman <span class="nv">$num</span> <span class="m">40</span> XL
<span class="nv">num</span><span class="o">=</span><span class="nv">$?</span>
to_roman <span class="nv">$num</span> <span class="m">10</span> X
<span class="nv">num</span><span class="o">=</span><span class="nv">$?</span>
to_roman <span class="nv">$num</span> <span class="m">9</span> IX
<span class="nv">num</span><span class="o">=</span><span class="nv">$?</span>
to_roman <span class="nv">$num</span> <span class="m">5</span> V
<span class="nv">num</span><span class="o">=</span><span class="nv">$?</span>
to_roman <span class="nv">$num</span> <span class="m">4</span> IV
<span class="nv">num</span><span class="o">=</span><span class="nv">$?</span>
to_roman <span class="nv">$num</span> <span class="m">1</span> I
<span class="c"># Successive calls to conversion function!</span>
<span class="c"># Is this really necessary??? Can it be simplified?</span>

<span class="nb">echo</span>

<span class="nb">exit</span>
</pre></div>
</div>
<p>See also <a class="reference external" href="testbranch.html#ISALPHA">Example 11-29</a> .</p>
</div></blockquote>
<div class="admonition important">
<p class="first admonition-title">Important</p>
<p class="last">The largest positive integer a function can return is 255. The
<strong>return</strong> command is closely tied to the concept of <a class="reference external" href="exit-status.html#EXITSTATUSREF">exit
status</a> , which accounts for this
particular limitation. Fortunately, there are various
<a class="reference external" href="assortedtips.html#RVT">workarounds</a> for those situations
requiring a large integer return value from a function.</p>
</div>
</div>
<div class="section" id="exemple-9-testing-large-return-values-in-a-function">
<h2>Exemple 9. Testing large return values in a function<a class="headerlink" href="#exemple-9-testing-large-return-values-in-a-function" title="Link permanent a aquest títol">¶</a></h2>
<blockquote>
<div><div class="highlight-sh"><div class="highlight"><pre><span class="c">#!/bin/bash</span>
<span class="c"># return-test.sh</span>

<span class="c"># The largest positive value a function can return is 255.</span>

return_test <span class="o">()</span>         <span class="c"># Returns whatever passed to it.</span>
<span class="o">{</span>
  <span class="k">return</span> <span class="nv">$1</span>
<span class="o">}</span>

return_test <span class="m">27</span>         <span class="c"># o.k.</span>
<span class="nb">echo</span> <span class="nv">$?</span>                <span class="c"># Returns 27.</span>

return_test <span class="m">255</span>        <span class="c"># Still o.k.</span>
<span class="nb">echo</span> <span class="nv">$?</span>                <span class="c"># Returns 255.</span>

return_test <span class="m">257</span>        <span class="c"># Error!</span>
<span class="nb">echo</span> <span class="nv">$?</span>                <span class="c"># Returns 1 (return code for miscellaneous error).</span>

<span class="c"># =========================================================</span>
return_test -151896    <span class="c"># Do large negative numbers work?</span>
<span class="nb">echo</span> <span class="nv">$?</span>                <span class="c"># Will this return -151896?</span>
                       <span class="c"># No! It returns 168.</span>
<span class="c">#  Version of Bash before 2.05b permitted</span>
<span class="c">#+ large negative integer return values.</span>
<span class="c">#  It happened to be a useful feature.</span>
<span class="c">#  Newer versions of Bash unfortunately plug this loophole.</span>
<span class="c">#  This may break older scripts.</span>
<span class="c">#  Caution!</span>
<span class="c"># =========================================================</span>

<span class="nb">exit </span>0
</pre></div>
</div>
<p>A workaround for obtaining large integer &#8220;return values&#8221; is to
simply assign the &#8220;return value&#8221; to a global variable.</p>
</div></blockquote>
<hr class="docutils" />
<div class="highlight-sh"><div class="highlight"><pre><span class="nv">Return_Val</span><span class="o">=</span>   <span class="c"># Glob</span>
</pre></div>
</div>
<p>al variable to hold over
size return value of fun
ction.</p>
<blockquote>
<div><blockquote>
<div><p>alt_return_test ()
{</p>
<blockquote>
<div>fvar=$1
Return_Val=$fvar
return   # Returns</div></blockquote>
</div></blockquote>
<dl class="docutils">
<dt>0 (success).</dt>
<dd><p class="first">}</p>
<p>alt_return_test 1
echo $?</p>
<blockquote>
<div># 0</div></blockquote>
<p class="last">echo &#8220;return value =</p>
</dd>
</dl>
<p>$Return_Val&#8221;    # 1</p>
<blockquote>
<div>alt_return_test 256
echo &#8220;return value =</div></blockquote>
<p>$Return_Val&#8221;    # 256</p>
<blockquote>
<div>alt_return_test 257
echo &#8220;return value =</div></blockquote>
<p>$Return_Val&#8221;    # 257</p>
<blockquote>
<div>alt_return_test 2570</div></blockquote>
</div></blockquote>
<dl class="docutils">
<dt>1</dt>
<dd><blockquote class="first">
<div>echo &#8220;return value =</div></blockquote>
<p class="last">$Return_Val&#8221;    #25701</p>
</dd>
</dl>
<hr class="docutils" />
<blockquote>
<div>A more elegant method is to have the function <strong>echo</strong> its &#8220;return
value to ``             stdout            `` ,&#8221; and then capture it
by <a class="reference external" href="commandsub.html#COMMANDSUBREF">command substitution</a> . See
the <a class="reference external" href="assortedtips.html#RVT">discussion of this</a> in <a class="reference external" href="assortedtips.html">Section
36.7</a> .</div></blockquote>
</div>
<div class="section" id="exemple-10-comparing-two-large-integers">
<h2>Exemple 10. Comparing two large integers<a class="headerlink" href="#exemple-10-comparing-two-large-integers" title="Link permanent a aquest títol">¶</a></h2>
<blockquote>
<div><div class="highlight-sh"><div class="highlight"><pre><span class="c">#!/bin/bash</span>
<span class="c"># max2.sh: Maximum of two LARGE integers.</span>

<span class="c">#  This is the previous &quot;max.sh&quot; example,</span>
<span class="c">#+ modified to permit comparing large integers.</span>

<span class="nv">EQUAL</span><span class="o">=</span><span class="m">0</span>             <span class="c"># Return value if both params equal.</span>
<span class="nv">E_PARAM_ERR</span><span class="o">=</span>-99999  <span class="c"># Not enough params passed to function.</span>
<span class="c">#           ^^^^^^    Out of range of any params that might be passed.</span>

max2 <span class="o">()</span>             <span class="c"># &quot;Returns&quot; larger of two numbers.</span>
<span class="o">{</span>
<span class="k">if</span> <span class="o">[</span> -z <span class="s2">&quot;</span><span class="nv">$2</span><span class="s2">&quot;</span> <span class="o">]</span>
<span class="k">then</span>
  <span class="nb">echo</span> <span class="nv">$E_PARAM_ERR</span>
  <span class="k">return</span>
<span class="k">fi</span>

<span class="k">if</span> <span class="o">[</span> <span class="s2">&quot;</span><span class="nv">$1</span><span class="s2">&quot;</span> -eq <span class="s2">&quot;</span><span class="nv">$2</span><span class="s2">&quot;</span> <span class="o">]</span>
<span class="k">then</span>
  <span class="nb">echo</span> <span class="nv">$EQUAL</span>
  <span class="k">return</span>
<span class="k">else</span>
  <span class="k">if</span> <span class="o">[</span> <span class="s2">&quot;</span><span class="nv">$1</span><span class="s2">&quot;</span> -gt <span class="s2">&quot;</span><span class="nv">$2</span><span class="s2">&quot;</span> <span class="o">]</span>
  <span class="k">then</span>
    <span class="nv">retval</span><span class="o">=</span><span class="nv">$1</span>
  <span class="k">else</span>
    <span class="nv">retval</span><span class="o">=</span><span class="nv">$2</span>
  <span class="k">fi</span>
<span class="k">fi</span>

<span class="nb">echo</span> <span class="nv">$retval</span>        <span class="c"># Echoes (to stdout), rather than returning value.</span>
                    <span class="c"># Why?</span>
<span class="o">}</span>


<span class="nv">return_val</span><span class="o">=</span><span class="k">$(</span>max2 <span class="m">33001</span> 33997<span class="k">)</span>
<span class="c">#            ^^^^             Function name</span>
<span class="c">#                 ^^^^^ ^^^^^ Params passed</span>
<span class="c">#  This is actually a form of command substitution:</span>
<span class="c">#+ treating a function as if it were a command,</span>
<span class="c">#+ and assigning the stdout of the function to the variable &quot;return_val.&quot;</span>


<span class="c"># ========================= OUTPUT ========================</span>
<span class="k">if</span> <span class="o">[</span> <span class="s2">&quot;</span><span class="nv">$return_val</span><span class="s2">&quot;</span> -eq <span class="s2">&quot;</span><span class="nv">$E_PARAM_ERR</span><span class="s2">&quot;</span> <span class="o">]</span>
  <span class="k">then</span>
  <span class="nb">echo</span> <span class="s2">&quot;Error in parameters passed to comparison function!&quot;</span>
<span class="k">elif</span> <span class="o">[</span> <span class="s2">&quot;</span><span class="nv">$return_val</span><span class="s2">&quot;</span> -eq <span class="s2">&quot;</span><span class="nv">$EQUAL</span><span class="s2">&quot;</span> <span class="o">]</span>
  <span class="k">then</span>
    <span class="nb">echo</span> <span class="s2">&quot;The two numbers are equal.&quot;</span>
<span class="k">else</span>
    <span class="nb">echo</span> <span class="s2">&quot;The larger of the two numbers is </span><span class="nv">$return_val</span><span class="s2">.&quot;</span>
<span class="k">fi</span>
<span class="c"># =========================================================</span>

<span class="nb">exit </span>0

<span class="c">#  Exercises:</span>
<span class="c">#  ---------</span>
<span class="c">#  1) Find a more elegant way of testing</span>
<span class="c">#+    the parameters passed to the function.</span>
<span class="c">#  2) Simplify the if/then structure at &quot;OUTPUT.&quot;</span>
<span class="c">#  3) Rewrite the script to take input from command-line parameters.</span>
</pre></div>
</div>
<p>Here is another example of capturing a function &#8220;return value.&#8221;
Understanding it requires some knowledge of
<a class="reference external" href="awk.html#AWKREF">awk</a> .</p>
</div></blockquote>
<hr class="docutils" />
<div class="highlight-sh"><div class="highlight"><pre>month_length <span class="o">()</span>  <span class="c"># T</span>
</pre></div>
</div>
<p>akes month number as an
argument.</p>
<blockquote>
<div>{                # R</div></blockquote>
<dl class="docutils">
<dt>eturns number of days in</dt>
<dd><dl class="first last docutils">
<dt>month.</dt>
<dd>monthD=&#8221;31 28 31 30</dd>
</dl>
</dd>
<dt>31 30 31 31 30 31 30 31&#8221;</dt>
<dd><blockquote class="first">
<div><dl class="docutils">
<dt># Declare as local?</dt>
<dd>echo &#8220;$monthD&#8221; | awk</dd>
</dl>
</div></blockquote>
<dl class="last docutils">
<dt>&#8216;{ print $&#8217;&#8221;${1}&#8221;&#8217; }&#8217;</dt>
<dd><dl class="first last docutils">
<dt># Tricky.</dt>
<dd><dl class="first docutils">
<dt>#</dt>
<dd></dd>
</dl>
<p class="last"># Parameter passed t</p>
</dd>
</dl>
</dd>
</dl>
</dd>
<dt>o function  ($1 &#8211; month</dt>
<dd><dl class="first last docutils">
<dt>number), then to awk.</dt>
<dd># Awk sees this as &#8220;</dd>
</dl>
</dd>
</dl>
<p>print $1 . . . print $12
&#8221; (depending on month nu
mber)</p>
<blockquote>
<div># Template for passi</div></blockquote>
<p>ng a parameter to embedd
ed awk script:</p>
<blockquote>
<div><dl class="docutils">
<dt>#</dt>
<dd>$&#8217;&#8221;${scrip</dd>
</dl>
</div></blockquote>
<p>t_parameter}&#8221;&#8217;</p>
<blockquote>
<div>#    Here&#8217;s a slight</div></blockquote>
<p>ly simpler awk construct
:</p>
<blockquote>
<div>#    echo $monthD |</div></blockquote>
<p>awk -v month=$1 &#8216;{print
$(month)}&#8217;</p>
<blockquote>
<div><blockquote>
<div>#    Uses the -v awk</div></blockquote>
<p>option, which assigns a
variable value</p>
<blockquote>
<div>#+   prior to execut</div></blockquote>
</div></blockquote>
<p>ion of the awk program b
lock.</p>
<blockquote>
<div>#    Thank you, Rich</div></blockquote>
<p>.</p>
<blockquote>
<div>#  Needs error check</div></blockquote>
<p>ing for correct paramete
r range (1-12)</p>
<blockquote>
<div>#+ and for February</div></blockquote>
<dl class="docutils">
<dt>in leap year.</dt>
<dd><p class="first">}</p>
<p class="last"># &#8212;&#8212;&#8212;&#8212;&#8212;&#8212;</p>
</dd>
</dl>
<blockquote>
<div># Usage example:
month=4        # Apr</div></blockquote>
<p>il, for example (4th mon
th).</p>
<blockquote>
<div>days_in=$(month_leng</div></blockquote>
<dl class="docutils">
<dt>th $month)</dt>
<dd>echo $days_in  # 30
# &#8212;&#8212;&#8212;&#8212;&#8212;&#8212;</dd>
</dl>
<hr class="docutils" />
<blockquote>
<div><p>See also <a class="reference external" href="contributed-scripts.html#DAYSBETWEEN">Example A-7</a> and
<a class="reference external" href="contributed-scripts.html#STDDEV">Example A-37</a> .</p>
<p>``                         Exercise:                       `` Using
what we have just learned, extend the previous <a class="reference external" href="complexfunct.html#EX61">Roman numerals
example</a> to accept arbitrarily large
input.</p>
<div class="highlight-sh"><div class="highlight"><pre><span class="c">#!/bin/bash</span>
<span class="c"># return-test.sh</span>

<span class="c"># The largest positive value a function can return is 255.</span>

return_test <span class="o">()</span>         <span class="c"># Returns whatever passed to it.</span>
<span class="o">{</span>
  <span class="k">return</span> <span class="nv">$1</span>
<span class="o">}</span>

return_test <span class="m">27</span>         <span class="c"># o.k.</span>
<span class="nb">echo</span> <span class="nv">$?</span>                <span class="c"># Returns 27.</span>

return_test <span class="m">255</span>        <span class="c"># Still o.k.</span>
<span class="nb">echo</span> <span class="nv">$?</span>                <span class="c"># Returns 255.</span>

return_test <span class="m">257</span>        <span class="c"># Error!</span>
<span class="nb">echo</span> <span class="nv">$?</span>                <span class="c"># Returns 1 (return code for miscellaneous error).</span>

<span class="c"># =========================================================</span>
return_test -151896    <span class="c"># Do large negative numbers work?</span>
<span class="nb">echo</span> <span class="nv">$?</span>                <span class="c"># Will this return -151896?</span>
                       <span class="c"># No! It returns 168.</span>
<span class="c">#  Version of Bash before 2.05b permitted</span>
<span class="c">#+ large negative integer return values.</span>
<span class="c">#  It happened to be a useful feature.</span>
<span class="c">#  Newer versions of Bash unfortunately plug this loophole.</span>
<span class="c">#  This may break older scripts.</span>
<span class="c">#  Caution!</span>
<span class="c"># =========================================================</span>

<span class="nb">exit </span>0
</pre></div>
</div>
<div class="highlight-sh"><div class="highlight"><pre><span class="nv">Return_Val</span><span class="o">=</span>   <span class="c"># Global variable to hold oversize return value of function.</span>

alt_return_test <span class="o">()</span>
<span class="o">{</span>
  <span class="nv">fvar</span><span class="o">=</span><span class="nv">$1</span>
  <span class="nv">Return_Val</span><span class="o">=</span><span class="nv">$fvar</span>
  <span class="k">return</span>   <span class="c"># Returns 0 (success).</span>
<span class="o">}</span>

alt_return_test 1
<span class="nb">echo</span> <span class="nv">$?</span>                              <span class="c"># 0</span>
<span class="nb">echo</span> <span class="s2">&quot;return value = </span><span class="nv">$Return_Val</span><span class="s2">&quot;</span>    <span class="c"># 1</span>

alt_return_test 256
<span class="nb">echo</span> <span class="s2">&quot;return value = </span><span class="nv">$Return_Val</span><span class="s2">&quot;</span>    <span class="c"># 256</span>

alt_return_test 257
<span class="nb">echo</span> <span class="s2">&quot;return value = </span><span class="nv">$Return_Val</span><span class="s2">&quot;</span>    <span class="c"># 257</span>

alt_return_test 25701
<span class="nb">echo</span> <span class="s2">&quot;return value = </span><span class="nv">$Return_Val</span><span class="s2">&quot;</span>    <span class="c">#25701</span>
</pre></div>
</div>
<div class="highlight-sh"><div class="highlight"><pre><span class="c">#!/bin/bash</span>
<span class="c"># max2.sh: Maximum of two LARGE integers.</span>

<span class="c">#  This is the previous &quot;max.sh&quot; example,</span>
<span class="c">#+ modified to permit comparing large integers.</span>

<span class="nv">EQUAL</span><span class="o">=</span><span class="m">0</span>             <span class="c"># Return value if both params equal.</span>
<span class="nv">E_PARAM_ERR</span><span class="o">=</span>-99999  <span class="c"># Not enough params passed to function.</span>
<span class="c">#           ^^^^^^    Out of range of any params that might be passed.</span>

max2 <span class="o">()</span>             <span class="c"># &quot;Returns&quot; larger of two numbers.</span>
<span class="o">{</span>
<span class="k">if</span> <span class="o">[</span> -z <span class="s2">&quot;</span><span class="nv">$2</span><span class="s2">&quot;</span> <span class="o">]</span>
<span class="k">then</span>
  <span class="nb">echo</span> <span class="nv">$E_PARAM_ERR</span>
  <span class="k">return</span>
<span class="k">fi</span>

<span class="k">if</span> <span class="o">[</span> <span class="s2">&quot;</span><span class="nv">$1</span><span class="s2">&quot;</span> -eq <span class="s2">&quot;</span><span class="nv">$2</span><span class="s2">&quot;</span> <span class="o">]</span>
<span class="k">then</span>
  <span class="nb">echo</span> <span class="nv">$EQUAL</span>
  <span class="k">return</span>
<span class="k">else</span>
  <span class="k">if</span> <span class="o">[</span> <span class="s2">&quot;</span><span class="nv">$1</span><span class="s2">&quot;</span> -gt <span class="s2">&quot;</span><span class="nv">$2</span><span class="s2">&quot;</span> <span class="o">]</span>
  <span class="k">then</span>
    <span class="nv">retval</span><span class="o">=</span><span class="nv">$1</span>
  <span class="k">else</span>
    <span class="nv">retval</span><span class="o">=</span><span class="nv">$2</span>
  <span class="k">fi</span>
<span class="k">fi</span>

<span class="nb">echo</span> <span class="nv">$retval</span>        <span class="c"># Echoes (to stdout), rather than returning value.</span>
                    <span class="c"># Why?</span>
<span class="o">}</span>


<span class="nv">return_val</span><span class="o">=</span><span class="k">$(</span>max2 <span class="m">33001</span> 33997<span class="k">)</span>
<span class="c">#            ^^^^             Function name</span>
<span class="c">#                 ^^^^^ ^^^^^ Params passed</span>
<span class="c">#  This is actually a form of command substitution:</span>
<span class="c">#+ treating a function as if it were a command,</span>
<span class="c">#+ and assigning the stdout of the function to the variable &quot;return_val.&quot;</span>


<span class="c"># ========================= OUTPUT ========================</span>
<span class="k">if</span> <span class="o">[</span> <span class="s2">&quot;</span><span class="nv">$return_val</span><span class="s2">&quot;</span> -eq <span class="s2">&quot;</span><span class="nv">$E_PARAM_ERR</span><span class="s2">&quot;</span> <span class="o">]</span>
  <span class="k">then</span>
  <span class="nb">echo</span> <span class="s2">&quot;Error in parameters passed to comparison function!&quot;</span>
<span class="k">elif</span> <span class="o">[</span> <span class="s2">&quot;</span><span class="nv">$return_val</span><span class="s2">&quot;</span> -eq <span class="s2">&quot;</span><span class="nv">$EQUAL</span><span class="s2">&quot;</span> <span class="o">]</span>
  <span class="k">then</span>
    <span class="nb">echo</span> <span class="s2">&quot;The two numbers are equal.&quot;</span>
<span class="k">else</span>
    <span class="nb">echo</span> <span class="s2">&quot;The larger of the two numbers is </span><span class="nv">$return_val</span><span class="s2">.&quot;</span>
<span class="k">fi</span>
<span class="c"># =========================================================</span>

<span class="nb">exit </span>0

<span class="c">#  Exercises:</span>
<span class="c">#  ---------</span>
<span class="c">#  1) Find a more elegant way of testing</span>
<span class="c">#+    the parameters passed to the function.</span>
<span class="c">#  2) Simplify the if/then structure at &quot;OUTPUT.&quot;</span>
<span class="c">#  3) Rewrite the script to take input from command-line parameters.</span>
</pre></div>
</div>
<div class="highlight-sh"><div class="highlight"><pre>month_length <span class="o">()</span>  <span class="c"># Takes month number as an argument.</span>
<span class="o">{</span>                <span class="c"># Returns number of days in month.</span>
<span class="nv">monthD</span><span class="o">=</span><span class="s2">&quot;31 28 31 30 31 30 31 31 30 31 30 31&quot;</span>  <span class="c"># Declare as local?</span>
<span class="nb">echo</span> <span class="s2">&quot;</span><span class="nv">$monthD</span><span class="s2">&quot;</span>awk <span class="s1">&#39;{ print $&#39;</span><span class="s2">&quot;</span><span class="si">${</span><span class="nv">1</span><span class="si">}</span><span class="s2">&quot;</span><span class="s1">&#39; }&#39;</span>    <span class="c"># Tricky.</span>
<span class="c">#                             ^^^^^^^^^</span>
<span class="c"># Parameter passed to function  ($1 -- month number), then to awk.</span>
<span class="c"># Awk sees this as &quot;print $1 . . . print $12&quot; (depending on month number)</span>
<span class="c"># Template for passing a parameter to embedded awk script:</span>
<span class="c">#                                 $&#39;&quot;${script_parameter}&quot;&#39;</span>

<span class="c">#    Here&#39;s a slightly simpler awk construct:</span>
<span class="c">#    echo $monthDawk -v month=$1 &#39;{print $(month)}&#39;</span>
<span class="c">#    Uses the -v awk option, which assigns a variable value</span>
<span class="c">#+   prior to execution of the awk program block.</span>
<span class="c">#    Thank you, Rich.</span>

<span class="c">#  Needs error checking for correct parameter range (1-12)</span>
<span class="c">#+ and for February in leap year.</span>
<span class="o">}</span>

<span class="c"># ----------------------------------------------</span>
<span class="c"># Usage example:</span>
<span class="nv">month</span><span class="o">=</span><span class="m">4</span>        <span class="c"># April, for example (4th month).</span>
<span class="nv">days_in</span><span class="o">=</span><span class="k">$(</span>month_length <span class="nv">$month</span><span class="k">)</span>
<span class="nb">echo</span> <span class="nv">$days_in</span>  <span class="c"># 30</span>
<span class="c"># ----------------------------------------------</span>
</pre></div>
</div>
<div class="highlight-sh"><div class="highlight"><pre><span class="c">#!/bin/bash</span>
<span class="c"># return-test.sh</span>

<span class="c"># The largest positive value a function can return is 255.</span>

return_test <span class="o">()</span>         <span class="c"># Returns whatever passed to it.</span>
<span class="o">{</span>
  <span class="k">return</span> <span class="nv">$1</span>
<span class="o">}</span>

return_test <span class="m">27</span>         <span class="c"># o.k.</span>
<span class="nb">echo</span> <span class="nv">$?</span>                <span class="c"># Returns 27.</span>

return_test <span class="m">255</span>        <span class="c"># Still o.k.</span>
<span class="nb">echo</span> <span class="nv">$?</span>                <span class="c"># Returns 255.</span>

return_test <span class="m">257</span>        <span class="c"># Error!</span>
<span class="nb">echo</span> <span class="nv">$?</span>                <span class="c"># Returns 1 (return code for miscellaneous error).</span>

<span class="c"># =========================================================</span>
return_test -151896    <span class="c"># Do large negative numbers work?</span>
<span class="nb">echo</span> <span class="nv">$?</span>                <span class="c"># Will this return -151896?</span>
                       <span class="c"># No! It returns 168.</span>
<span class="c">#  Version of Bash before 2.05b permitted</span>
<span class="c">#+ large negative integer return values.</span>
<span class="c">#  It happened to be a useful feature.</span>
<span class="c">#  Newer versions of Bash unfortunately plug this loophole.</span>
<span class="c">#  This may break older scripts.</span>
<span class="c">#  Caution!</span>
<span class="c"># =========================================================</span>

<span class="nb">exit </span>0
</pre></div>
</div>
<div class="highlight-sh"><div class="highlight"><pre><span class="nv">Return_Val</span><span class="o">=</span>   <span class="c"># Global variable to hold oversize return value of function.</span>

alt_return_test <span class="o">()</span>
<span class="o">{</span>
  <span class="nv">fvar</span><span class="o">=</span><span class="nv">$1</span>
  <span class="nv">Return_Val</span><span class="o">=</span><span class="nv">$fvar</span>
  <span class="k">return</span>   <span class="c"># Returns 0 (success).</span>
<span class="o">}</span>

alt_return_test 1
<span class="nb">echo</span> <span class="nv">$?</span>                              <span class="c"># 0</span>
<span class="nb">echo</span> <span class="s2">&quot;return value = </span><span class="nv">$Return_Val</span><span class="s2">&quot;</span>    <span class="c"># 1</span>

alt_return_test 256
<span class="nb">echo</span> <span class="s2">&quot;return value = </span><span class="nv">$Return_Val</span><span class="s2">&quot;</span>    <span class="c"># 256</span>

alt_return_test 257
<span class="nb">echo</span> <span class="s2">&quot;return value = </span><span class="nv">$Return_Val</span><span class="s2">&quot;</span>    <span class="c"># 257</span>

alt_return_test 25701
<span class="nb">echo</span> <span class="s2">&quot;return value = </span><span class="nv">$Return_Val</span><span class="s2">&quot;</span>    <span class="c">#25701</span>
</pre></div>
</div>
<div class="highlight-sh"><div class="highlight"><pre><span class="c">#!/bin/bash</span>
<span class="c"># max2.sh: Maximum of two LARGE integers.</span>

<span class="c">#  This is the previous &quot;max.sh&quot; example,</span>
<span class="c">#+ modified to permit comparing large integers.</span>

<span class="nv">EQUAL</span><span class="o">=</span><span class="m">0</span>             <span class="c"># Return value if both params equal.</span>
<span class="nv">E_PARAM_ERR</span><span class="o">=</span>-99999  <span class="c"># Not enough params passed to function.</span>
<span class="c">#           ^^^^^^    Out of range of any params that might be passed.</span>

max2 <span class="o">()</span>             <span class="c"># &quot;Returns&quot; larger of two numbers.</span>
<span class="o">{</span>
<span class="k">if</span> <span class="o">[</span> -z <span class="s2">&quot;</span><span class="nv">$2</span><span class="s2">&quot;</span> <span class="o">]</span>
<span class="k">then</span>
  <span class="nb">echo</span> <span class="nv">$E_PARAM_ERR</span>
  <span class="k">return</span>
<span class="k">fi</span>

<span class="k">if</span> <span class="o">[</span> <span class="s2">&quot;</span><span class="nv">$1</span><span class="s2">&quot;</span> -eq <span class="s2">&quot;</span><span class="nv">$2</span><span class="s2">&quot;</span> <span class="o">]</span>
<span class="k">then</span>
  <span class="nb">echo</span> <span class="nv">$EQUAL</span>
  <span class="k">return</span>
<span class="k">else</span>
  <span class="k">if</span> <span class="o">[</span> <span class="s2">&quot;</span><span class="nv">$1</span><span class="s2">&quot;</span> -gt <span class="s2">&quot;</span><span class="nv">$2</span><span class="s2">&quot;</span> <span class="o">]</span>
  <span class="k">then</span>
    <span class="nv">retval</span><span class="o">=</span><span class="nv">$1</span>
  <span class="k">else</span>
    <span class="nv">retval</span><span class="o">=</span><span class="nv">$2</span>
  <span class="k">fi</span>
<span class="k">fi</span>

<span class="nb">echo</span> <span class="nv">$retval</span>        <span class="c"># Echoes (to stdout), rather than returning value.</span>
                    <span class="c"># Why?</span>
<span class="o">}</span>


<span class="nv">return_val</span><span class="o">=</span><span class="k">$(</span>max2 <span class="m">33001</span> 33997<span class="k">)</span>
<span class="c">#            ^^^^             Function name</span>
<span class="c">#                 ^^^^^ ^^^^^ Params passed</span>
<span class="c">#  This is actually a form of command substitution:</span>
<span class="c">#+ treating a function as if it were a command,</span>
<span class="c">#+ and assigning the stdout of the function to the variable &quot;return_val.&quot;</span>


<span class="c"># ========================= OUTPUT ========================</span>
<span class="k">if</span> <span class="o">[</span> <span class="s2">&quot;</span><span class="nv">$return_val</span><span class="s2">&quot;</span> -eq <span class="s2">&quot;</span><span class="nv">$E_PARAM_ERR</span><span class="s2">&quot;</span> <span class="o">]</span>
  <span class="k">then</span>
  <span class="nb">echo</span> <span class="s2">&quot;Error in parameters passed to comparison function!&quot;</span>
<span class="k">elif</span> <span class="o">[</span> <span class="s2">&quot;</span><span class="nv">$return_val</span><span class="s2">&quot;</span> -eq <span class="s2">&quot;</span><span class="nv">$EQUAL</span><span class="s2">&quot;</span> <span class="o">]</span>
  <span class="k">then</span>
    <span class="nb">echo</span> <span class="s2">&quot;The two numbers are equal.&quot;</span>
<span class="k">else</span>
    <span class="nb">echo</span> <span class="s2">&quot;The larger of the two numbers is </span><span class="nv">$return_val</span><span class="s2">.&quot;</span>
<span class="k">fi</span>
<span class="c"># =========================================================</span>

<span class="nb">exit </span>0

<span class="c">#  Exercises:</span>
<span class="c">#  ---------</span>
<span class="c">#  1) Find a more elegant way of testing</span>
<span class="c">#+    the parameters passed to the function.</span>
<span class="c">#  2) Simplify the if/then structure at &quot;OUTPUT.&quot;</span>
<span class="c">#  3) Rewrite the script to take input from command-line parameters.</span>
</pre></div>
</div>
<div class="highlight-sh"><div class="highlight"><pre>month_length <span class="o">()</span>  <span class="c"># Takes month number as an argument.</span>
<span class="o">{</span>                <span class="c"># Returns number of days in month.</span>
<span class="nv">monthD</span><span class="o">=</span><span class="s2">&quot;31 28 31 30 31 30 31 31 30 31 30 31&quot;</span>  <span class="c"># Declare as local?</span>
<span class="nb">echo</span> <span class="s2">&quot;</span><span class="nv">$monthD</span><span class="s2">&quot;</span>awk <span class="s1">&#39;{ print $&#39;</span><span class="s2">&quot;</span><span class="si">${</span><span class="nv">1</span><span class="si">}</span><span class="s2">&quot;</span><span class="s1">&#39; }&#39;</span>    <span class="c"># Tricky.</span>
<span class="c">#                             ^^^^^^^^^</span>
<span class="c"># Parameter passed to function  ($1 -- month number), then to awk.</span>
<span class="c"># Awk sees this as &quot;print $1 . . . print $12&quot; (depending on month number)</span>
<span class="c"># Template for passing a parameter to embedded awk script:</span>
<span class="c">#                                 $&#39;&quot;${script_parameter}&quot;&#39;</span>

<span class="c">#    Here&#39;s a slightly simpler awk construct:</span>
<span class="c">#    echo $monthDawk -v month=$1 &#39;{print $(month)}&#39;</span>
<span class="c">#    Uses the -v awk option, which assigns a variable value</span>
<span class="c">#+   prior to execution of the awk program block.</span>
<span class="c">#    Thank you, Rich.</span>

<span class="c">#  Needs error checking for correct parameter range (1-12)</span>
<span class="c">#+ and for February in leap year.</span>
<span class="o">}</span>

<span class="c"># ----------------------------------------------</span>
<span class="c"># Usage example:</span>
<span class="nv">month</span><span class="o">=</span><span class="m">4</span>        <span class="c"># April, for example (4th month).</span>
<span class="nv">days_in</span><span class="o">=</span><span class="k">$(</span>month_length <span class="nv">$month</span><span class="k">)</span>
<span class="nb">echo</span> <span class="nv">$days_in</span>  <span class="c"># 30</span>
<span class="c"># ----------------------------------------------</span>
</pre></div>
</div>
</div></blockquote>
<p>** Redirection**</p>
<dl class="docutils">
<dt>``                 Redirecting the stdin         of a function               ``</dt>
<dd>A function is essentially a <a class="reference external" href="special-chars.html#CODEBLOCKREF">code
block</a> , which means its
``         stdin        `` can be redirected (as in <a class="reference external" href="special-chars.html#EX8">Example
3-1</a> ).</dd>
</dl>
</div>
<div class="section" id="exemple-11-real-name-from-username">
<h2>Exemple 11. Real name from username<a class="headerlink" href="#exemple-11-real-name-from-username" title="Link permanent a aquest títol">¶</a></h2>
<blockquote>
<div><div class="highlight-sh"><div class="highlight"><pre><span class="c">#!/bin/bash</span>
<span class="c"># realname.sh</span>
<span class="c">#</span>
<span class="c"># From username, gets &quot;real name&quot; from /etc/passwd.</span>


<span class="nv">ARGCOUNT</span><span class="o">=</span><span class="m">1</span>       <span class="c"># Expect one arg.</span>
<span class="nv">E_WRONGARGS</span><span class="o">=</span>85

<span class="nv">file</span><span class="o">=</span>/etc/passwd
<span class="nv">pattern</span><span class="o">=</span><span class="nv">$1</span>

<span class="k">if</span> <span class="o">[</span> <span class="nv">$# </span>-ne <span class="s2">&quot;</span><span class="nv">$ARGCOUNT</span><span class="s2">&quot;</span> <span class="o">]</span>
<span class="k">then</span>
  <span class="nb">echo</span> <span class="s2">&quot;Usage: `basename </span><span class="nv">$0</span><span class="s2">` USERNAME&quot;</span>
  <span class="nb">exit</span> <span class="nv">$E_WRONGARGS</span>
<span class="k">fi</span>

file_excerpt <span class="o">()</span>    <span class="c">#  Scan file for pattern,</span>
<span class="o">{</span>                  <span class="c">#+ then print relevant portion of line.</span>
  <span class="k">while</span> <span class="nb">read </span>line  <span class="c"># &quot;while&quot; does not necessarily need [ condition ]</span>
  <span class="k">do</span>
    <span class="nb">echo</span> <span class="s2">&quot;</span><span class="nv">$line</span><span class="s2">&quot;</span>grep <span class="nv">$1</span> <span class="p">|</span> awk -F<span class="s2">&quot;:&quot;</span> <span class="s1">&#39;{ print $5 }&#39;</span>
    <span class="c"># Have awk use &quot;:&quot; delimiter.</span>
  <span class="k">done</span>
<span class="o">}</span> &lt;<span class="nv">$file</span>  <span class="c"># Redirect into function&#39;s stdin.</span>

file_excerpt <span class="nv">$pattern</span>

<span class="c"># Yes, this entire script could be reduced to</span>
<span class="c">#       grep PATTERN /etc/passwdawk -F&quot;:&quot; &#39;{ print $5 }&#39;</span>
<span class="c"># or</span>
<span class="c">#       awk -F: &#39;/PATTERN/ {print $5}&#39;</span>
<span class="c"># or</span>
<span class="c">#       awk -F: &#39;($1 == &quot;username&quot;) { print $5 }&#39; # real name from username</span>
<span class="c"># However, it might not be as instructive.</span>

<span class="nb">exit </span>0
</pre></div>
</div>
<p>There is an alternate, and perhaps less confusing method of
redirecting a function&#8217;s ``         stdin        `` . This involves
redirecting the ``         stdin        `` to an embedded bracketed
code block within the function.</p>
<div class="highlight-sh"><div class="highlight"><pre><span class="c"># Instead of:</span>
Function <span class="o">()</span>
<span class="o">{</span>
 ...
 <span class="o">}</span> &lt; file

<span class="c"># Try this:</span>
Function <span class="o">()</span>
<span class="o">{</span>
  <span class="o">{</span>
    ...
   <span class="o">}</span> &lt; file
<span class="o">}</span>

<span class="c"># Similarly,</span>

Function <span class="o">()</span>  <span class="c"># This works.</span>
<span class="o">{</span>
  <span class="o">{</span>
   <span class="nb">echo</span> <span class="nv">$*</span>
  <span class="o">}</span>tr a b
<span class="o">}</span>

Function <span class="o">()</span>  <span class="c"># This doesn&#39;t work.</span>
<span class="o">{</span>
  <span class="nb">echo</span> <span class="nv">$*</span>
<span class="o">}</span>tr a b   <span class="c"># A nested code block is mandatory here.</span>


<span class="c"># Thanks, S.C.</span>
</pre></div>
</div>
</div></blockquote>
<div class="admonition note">
<p class="first admonition-title">Nota</p>
<p class="last">Emmanuel Rouat&#8217;s <cite>sample `</cite>             bashrc            ``
file &lt;sample-bashrc.html&gt;`__ contains some instructive examples of
functions.</p>
</div>
<div class="section" id="notes">
<h3>Notes<a class="headerlink" href="#notes" title="Link permanent a aquest títol">¶</a></h3>
<p>` [1]  &lt;complexfunct.html#AEN18474&gt;`__</p>
<p>The <strong>return</strong> command is a Bash <a class="reference external" href="internal.html#BUILTINREF">builtin</a>
.</p>
</div>
</div>
</div>


          </div>
          <footer>
  <hr/>

  

  <div role="contentinfo">
    <p>
    </p>
  </div>
      Pàgina generada amb <a href="http://sphinx-doc.org/">Sphinx</a> amb una lleugera
                                     variació del tema<a
                                     href="https://github.com/snide/sphinx_rtd_theme">
                                         sphinx-rtd-theme </a>.

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'./',
            VERSION:'10 març de 2014',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true
        };
    </script>
      <script type="text/javascript" src="_static/jquery.js"></script>
      <script type="text/javascript" src="_static/underscore.js"></script>
      <script type="text/javascript" src="_static/doctools.js"></script>
      <script type="text/javascript" src="_static/translations.js"></script>

  

  
  
    <script type="text/javascript" src="_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
   

</body>
</html>